System.register(["jimu-core","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui","jimu-arcgis","jimu-ui/basic/color-picker","jimu-theme","jimu-ui/advanced/style-setting-components","jimu-ui/advanced/rich-text-editor","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/expression-builder"],(function(e,t){var s={},i={},a={},l={},n={},o={},r={},d={},h={},p={},c={},u={};return{setters:[function(e){s.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes,s.DataSourceManager=e.DataSourceManager,s.DataSourceTypes=e.DataSourceTypes,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.JimuMapViewStatus=e.JimuMapViewStatus,s.OrderRule=e.OrderRule,s.React=e.React,s.classNames=e.classNames,s.css=e.css,s.defaultMessages=e.defaultMessages,s.getAppStore=e.getAppStore,s.jsx=e.jsx,s.lodash=e.lodash,s.polished=e.polished,s.urlUtils=e.urlUtils},function(e){i.MapWidgetSelector=e.MapWidgetSelector,i.MultipleJimuMapConfig=e.MultipleJimuMapConfig,i.SettingRow=e.SettingRow,i.SettingSection=e.SettingSection,i.SidePopper=e.SidePopper},function(e){a.BaseWidgetSetting=e.BaseWidgetSetting},function(e){l.Alert=e.Alert,l.AlertPopup=e.AlertPopup,l.Button=e.Button,l.Checkbox=e.Checkbox,l.CollapsablePanel=e.CollapsablePanel,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Label=e.Label,l.NumericInput=e.NumericInput,l.Option=e.Option,l.Radio=e.Radio,l.Select=e.Select,l.Switch=e.Switch,l.TextArea=e.TextArea,l.TextInput=e.TextInput,l.Tooltip=e.Tooltip,l.defaultMessages=e.defaultMessages},function(e){n.MapViewManager=e.MapViewManager},function(e){o.ThemeColorPicker=e.ThemeColorPicker},function(e){r.getTheme2=e.getTheme2},function(e){d.FontStyle=e.FontStyle,d.InputUnit=e.InputUnit},function(e){h.FontFamily=e.FontFamily},function(e){p.List=e.List,p.TreeItemActionType=e.TreeItemActionType},function(e){c.AllDataSourceTypes=e.AllDataSourceTypes,c.DataSourceSelector=e.DataSourceSelector,c.FieldSelector=e.FieldSelector},function(e){u.ExpressionBuilder=e.ExpressionBuilder,u.ExpressionBuilderType=e.ExpressionBuilderType}],execute:function(){e((()=>{var e={748:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5Zm-9 0a3.501 3.501 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5ZM15.5 11l-5 1-3 4-1-9.5 9 4.5Zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38-2.517.503Z" clip-rule="evenodd"></path></svg>'},41553:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35.151.722.257 1.34.316 1.852.374.16.725.362 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 21.98 21.98 0 0 1-1.49 1.194 5.17 5.17 0 0 1-.007 1.183l1.464 1.119a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 22.445 22.445 0 0 1-1.807-.66c-.325.233-.679.43-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21.019 21.019 0 0 1-.317-1.853 5.34 5.34 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546c.567-.49 1.063-.888 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196c.719.233 1.321.453 1.807.66.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994h2.839Zm-.365 1H6.985l-.28 1.866-.467.19c-.235.095-.46.21-.672.34l-.207.136-.42.293-.476-.197c-.328-.137-.718-.281-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4.127 4.127 0 0 0-.021.816l.014.144.058.492-.419.294c-.288.203-.615.451-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29c.204.146.42.274.645.384l.228.103.474.199.059.49c.04.338.103.731.19 1.177l.043.219h2.088l.282-1.867.466-.19c.236-.095.46-.21.672-.34l.207-.136.419-.293.476.198c.33.136.72.28 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4.131 4.131 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18.1 18.1 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.496 4.496 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49c-.032-.27-.08-.576-.14-.916l-.094-.48Zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" clip-rule="evenodd"></path></svg>'},11407:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.538.538 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.538.538 0 0 1 .738 0Z" clip-rule="evenodd"></path></svg>'},58959:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 3a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1h-4ZM1 6.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5ZM1.5 9a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1h-10ZM1.5 12a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Z"></path></svg>'},99820:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 13a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1h-4ZM1 9.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5ZM1.5 7a.5.5 0 0 1 0-1h10a.5.5 0 0 1 0 1h-10ZM1.5 4a.5.5 0 0 1 0-1h13a.5.5 0 0 1 0 1h-13Z"></path></svg>'},55339:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z"></path></svg>'},59216:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.226 1.312c-.403-.404-1.044-.417-1.431-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431l-1.462-1.462Zm-8.113 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991-1.781.32Zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402 1.461 1.461Z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Z"></path></svg>'},88866:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2ZM6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5Z"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14Z" clip-rule="evenodd"></path></svg>'},79964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" clip-rule="evenodd"></path></svg>'},17e3:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgOCA4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgZmlsbD0nIzI4MjgyOCc+DQogICAgPHBhdGggZD0iTTMuNSAzLjV2LTNhLjUuNSAwIDAxMSAwdjNoM2EuNS41IDAgMDEwIDFoLTN2M2EuNS41IDAgMDEtMSAwdi0zaC0zYS41LjUgMCAwMTAtMWgzeiIgZmlsbC1ydWxlPSJldmVub2RkIj48L3BhdGg+DQo8L3N2Zz4="},26826:e=>{"use strict";e.exports=n},48891:e=>{"use strict";e.exports=s},23137:e=>{"use strict";e.exports=a},34796:e=>{"use strict";e.exports=r},30726:e=>{"use strict";e.exports=l},338:e=>{"use strict";e.exports=c},39342:e=>{"use strict";e.exports=u},65492:e=>{"use strict";e.exports=h},77756:e=>{"use strict";e.exports=i},55505:e=>{"use strict";e.exports=d},41362:e=>{"use strict";e.exports=o},59587:e=>{"use strict";e.exports=p}},t={};function m(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,m),a.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var s in t)m.o(t,s)&&!m.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="";var y={};return m.p=window.jimuConfig.baseUrl,(()=>{"use strict";m.r(y),m.d(y,{__set_webpack_public_path__:()=>Oe,default:()=>Le});var e=m(48891),t=m(77756),s=m(23137),i=m(30726),a=m(26826);const l={selectMapWidgetLabel:"Select a map widget",warningMsgIfNoLayersOnMap:"This map does not contain any feature layers. Select a map with at least one feature layer.",generalSettingsLabel:"General Settings",highlightColor:"Sketch color",highlightColorTooltip:"Indicate the desired color for sketching on the map",onlyShowResults:"Filter layers to only show results",onlyShowResultsTooltip:"Filter the data source to only show features from the analysis results. Other widgets connected to this data source will be filtered.",noResultsFoundLabel:"No results found message",noDataMessageDefaultText:"No results found.",promptMessageLabel:"Custom welcome message",promptMessageLabelToolTip:"Provide users with instructions on how to start the workflow.",headingLabel:"Heading label",locationLabel:"Location",currentMapAreaLabel:"Explore features within current map area",disabledDefineSearchAreaLabel:"Explore all features",defineSearchAreaTooltip:"Assess all features within the map area, or specify a location using sketch tools or the output from another widget.",defineSearchAreaLabel:"Define a search method",featuresOutsideMapArea:"Include features outside map area",searchAreaHint:"No search area is defined and all the features will be displayed. Any configured Closest Feature analysis will be ignored.",showSketchTools:"Show sketch tools",bufferDistance:"Search distance",distanceUnits:"Distance units",searchByActiveMapArea:"Current map area",searchByLocation:"Specify a location",showDistanceSettings:"Show distance settings",showDistFromInputLoc:"Show distance label",mapSettingsHintMsg:"Click a map below to configure the analysis settings.",analysisSettingsLabel:"Analysis Settings",addAnalysisLabel:"Add Analysis",configureAnalysisTooltip:"Configure closest feature, proximity, or summary analysis for layers in the map. Configured layers will be used for analysis regardless of their visibility in the map.",configureLayerAnalysis:"Configure analysis for layers",selectLayer:"Select layer",closest:"Closest Feature",analysisTypeLabel:"Analysis Type",highlightResultsOnMapLabel:"Highlight results on map",highlightColorLabel:"Highlight color",closestAnalysisTypeTooltip:"Find the closest feature.",closestFeatureMaxDistLabel:"Maximum distance",warningMsgIfActiveMapArea:'"Current map area" is defined as the search method. No results will be shown for this analysis type.',proximity:"Proximity",proximityAnalysisTypeTooltip:"Find features within a specified distance.",displayFieldLabel:"Display field",sortFeaturesLabel:"Sort features",distanceLabel:"Distance",noSelectionItemLabel:"- Select -",groupFeaturesLabel:"Group features",sortGroupsByCount:"Sort groups by count",expandOnOpen:"Expand analysis results",expandFeatureDetails:"Expand feature details",expandListTooltip:"Use with caution: performance may be impacted for analysis results with a large number of features.",summary:"Summary",summaryAnalysisTypeTooltip:"Summarize numeric values.",addSummaryFields:"Add Summary",editSummaryField:"Edit Summary Field",editExpression:"Edit Expression",editAnalysis:"Edit Analysis",editSumOfIntersectedArea:"Edit sum of intersected area",editSumOfIntersectedLength:"Edit sum of intersected length",showSeparator:"Show thousand separator",sumOfIntersectedArea:"Sum of intersected area",sumOfIntersectedLength:"Sum of intersected length",sumOfAreaTooltip:"Sum of intersected area calculates the area of polygon intersected by search geometry",sumOfLengthTooltip:"Sum of intersected length calculates the length of polyline intersected by search geometry",noFormatting:"No formatting",round:"Round",truncate:"Truncate",significantDigitsLabel:"Significant digits",singleColor:"Single color",byCategory:"By category",summaryFieldColor:"Define summary colors",applyColors:"Apply colors",colorStrip:"Color strip",displayFeatureCountLabel:"Display feature count",displayAnalysisIconLabel:"Display analysis icon",addSummaryHintMsg:"Add new summary expressions or only display the feature count."};function n(t,s){return e.css`
  .alignTooltip {
    margin-right: -6px;
  }
  
  .disabled-label{
    color: ${t.colors.palette.light[800]};
  }

  .nearme-analysis-list-items {
    .analysis-item {
      padding: 4px 2px 8px 2px;

      .layer-analysis-name {
        font-size: ${e.polished.rem(14)};
        font-weight: 400;
        width: ${s?"150px":"165px"};
       }

      .analysis-type-name {
        font-size: ${e.polished.rem(13)};
        padding-top: 10px;
        width: 165px;
      }
    }

    .cursor-pointer {
      cursor: pointer;
    }
  }

  .sort-field-section {
    display: flex;
    align-items: center;
    flex: 1;
    .sort-field-selector {
      background:${t.colors.palette.secondary[200]};
      border-radius: 2px;
      flex: 1;
      width: 0
    }

    .order-button {
        cursor: pointer;
        text-align:right;
        margin-left: ${e.polished.rem(2)};
    }

    .order-button svg {
        margin-right:0;
    }
  }

  .sort-icon {
    & {
        margin-left:5px;
    }

    .sort-button-l {
      border-radius: 2px 0 0 2px;
      border-right:none;
    }

    .sort-button-r {
      border-radius: 0px 2px 2px 0px;
      border-left:none;
    }

    .sort-button {
      border-color: ${t.border.color};
    }

    svg {
      margin-right:0;
    }
  }

  .cursor-pointer {
    cursor: pointer;
  }

  .add-summary-field {
    height: ${e.polished.rem(40)};
    width: 100%;
    color: ${t.colors.palette.primary[700]};
    font-size: ${e.polished.rem(14)};
    cursor: pointer;
    &:hover {
      .add-summary-field-icon-container {
        background-color: ${t.colors.palette.primary[800]};
      }
      color: ${t.colors.palette.primary[800]};
    }
    .add-summary-field-icon-container {
      width: 20px;
      height: 20px;
      background-color: ${t.colors.palette.primary[700]};
      border-radius: 10px;
    }
    .add-summary-field-icon {
      color: ${t.colors.palette.light[300]};
    }
  }

  .fieldName {
    width: 180px;
  }

  .nearme-summary-fields-list-items {
    flex: 1;
    max-height: 290px;
    overflow-y: auto;
    margin-bottom: 10px;
    margin-top: 3px;

    .labelAlign {
      width: calc(100% - 65px);
      max-width: 155px;
    }

    .jimu-tree-item.jimu-tree-item_dnd-true {
      height: auto;
      padding-top: 0rem;
  
      .jimu-tree-item__body {
        padding: 4px 0px 4px 0px;
      }
    }
  }

  .nearme-divider {
    border-top: 1px solid var(--light-800);
  }

  .colorModesWidth {
    width: calc(100% - 30px);
  }

  .analysisTypeWidth { 
    width: calc(100% - 16px);
  }
  `}function o(t){return e.css`
    position: absolute;
    top: 0;
    bottom: 0;
    width: 259px;
    height: 100%;
    padding-bottom: 1px;
    border-right: 1px solid ${t.colors.white};
    border-bottom: 1px solid ${t.colors.white};

    .setting-container {
      height: calc(100% - 52px);
      overflow: auto;
    }
`}function r(t){return e.css`
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: var(--dark-800);
    > .color-list {
      width: 100%;
      flex-grow: 1;
      overflow-y: auto;
      max-height: 562px;
    }
    > .footer {
      height: 57px;
      width: 100%;
      border-top: 1px solid #6a6a6a;
      > div {
        display: flex;
        width: 100%;
        justify-content: space-between;
      }
    }

    .colorItemStyle {
      display: flex;
      width: 100%;
      justify-content: space-between;
      label {
        width: 88%;
        flex-grow: 1;
        display: inline-flex;
        justify-content: space-between;
        .label {
          max-width: 70%;
        }
      }
    }
`}var d;!function(e){e.Closest="closest",e.Proximity="proximity",e.Summary="summary"}(d||(d={}));var h=m(748),p=m.n(h);const c=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:p()},a)):e.React.createElement("svg",Object.assign({className:l},a))};const u=t=>e.DataSourceManager.getInstance().getDataSource(t);var g;!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(g||(g={}));const f=e=>{switch(e){case"feet":return g.Feet;case"miles":return g.Miles;case"kilometers":return g.Kilometers;case"meters":return g.Meters;case"yards":return g.Yards;default:return 1e3}},S=t=>{return s=void 0,i=void 0,n=function*(){let s=null;const i=[];let l=!1;const n=a.MapViewManager.getInstance().getJimuMapViewById(t),o=yield null==n?void 0:n.whenAllJimuLayerViewLoaded();for(const t in o){const a=yield n.whenJimuLayerViewLoaded(t);s=u(a.layerDataSourceId),s&&((null==s?void 0:s.type)===e.DataSourceTypes.MapService||(null==s?void 0:s.type)===e.DataSourceTypes.GroupLayer?s.getChildDataSources().forEach((e=>{i.push(e)})):i.length>0?(i.find((e=>e.id===s.id))||(l=!0),l&&i.push(s)):i.push(s))}return i},new((l=void 0)||(l=Promise))((function(e,t){function a(e){try{r(n.next(e))}catch(e){t(e)}}function o(e){try{r(n.throw(e))}catch(e){t(e)}}function r(t){var s;t.done?e(t.value):(s=t.value,s instanceof l?s:new l((function(e){e(s)}))).then(a,o)}r((n=n.apply(s,i||[])).next())}));var s,i,l,n},x=e=>{let t="";return t=e.objectIdField?e.objectIdField:e.displayField?e.displayField:e.fields[0].name,t},b=(e,t,s)=>`${e}_output_${t}_${s}`,v=()=>`${Math.random()}`.slice(2).toString();var C=m(41362),I=m(88866),F=m.n(I);const w=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:F()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var L=m(34796),O=m(55505),A=m(65492);class j extends e.React.PureComponent{constructor(e){var t,s,i,a,n,o,r;super(e),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onTextChange=e=>{this.setState({promptMessage:e}),this.props.noResultFound?this.props.onTextMessageChange(this.props.noResultFound,e):this.props.onTextMessageChange(this.props.promptTextMessage,e)},this.textStyleObj=(e,t,s,i,a,l,n)=>{const o={fontFamily:e,fontBold:t,fontItalic:s,fontUnderline:i,fontStrike:a,fontColor:l,fontSize:n};this.props.noResultFound?this.props.onTextFormatChange(this.props.noResultFound,o):this.props.onTextFormatChange(this.props.promptTextMessage,o)},this.handleFontChange=e=>{this.setState({fontFamily:e},(()=>{this.textStyleObj(e,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)}))},this.setFontStyleValues=()=>{this.textStyleObj(this.state.fontFamily,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)},this.handleFontStyleChange=(e,t)=>{switch(e){case"bold":this.setState({fontBold:t},(()=>{this.setFontStyleValues()}));break;case"italic":this.setState({fontItalic:t},(()=>{this.setFontStyleValues()}));break;case"underline":this.setState({fontUnderline:t,fontStrike:!1},(()=>{this.setFontStyleValues()}));break;case"strike":this.setState({fontUnderline:!1,fontStrike:t},(()=>{this.setFontStyleValues()}))}},this.handleColorChange=e=>{this.setState({fontColor:e||"var(--black)"},(()=>{this.textStyleObj(this.state.fontFamily,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)}))},this.handleFontSizeChange=e=>{!e||e.distance<4||this.setState({fontSize:e.distance+e.unit},(()=>{this.textStyleObj(this.state.fontFamily,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)}))},this.state={promptMessage:this.props.hintMessage,fontFamily:null===(t=this.props.textStyle)||void 0===t?void 0:t.fontFamily,fontBold:null===(s=this.props.textStyle)||void 0===s?void 0:s.fontBold,fontItalic:null===(i=this.props.textStyle)||void 0===i?void 0:i.fontItalic,fontUnderline:null===(a=this.props.textStyle)||void 0===a?void 0:a.fontUnderline,fontStrike:null===(n=this.props.textStyle)||void 0===n?void 0:n.fontStrike,fontColor:null===(o=this.props.textStyle)||void 0===o?void 0:o.fontColor,fontSize:null===(r=this.props.textStyle)||void 0===r?void 0:r.fontSize}}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%"}},(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.TextArea,{tabIndex:0,className:"w-100",name:"text","aria-label":this.state.promptMessage,defaultValue:this.props.hintMessage,onBlur:e=>{this.onTextChange(e.target.value)}})),(0,e.jsx)("div",{className:"w-100 pt-2"},(0,e.jsx)(A.FontFamily,{className:"w-100",font:this.state.fontFamily,onChange:this.handleFontChange}),(0,e.jsx)("div",{className:"d-flex justify-content-between mt-2"},(0,e.jsx)(O.FontStyle,{style:{width:"103px"},onChange:this.handleFontStyleChange,bold:this.state.fontBold,italic:this.state.fontItalic,underline:this.state.fontUnderline,strike:this.state.fontStrike}),(0,e.jsx)(C.ThemeColorPicker,{style:{width:"25px"},specificTheme:(0,L.getTheme2)(),value:this.state.fontColor,onChange:this.handleColorChange}),(0,e.jsx)(O.InputUnit,{style:{width:"76px"},min:4,max:72,value:this.state.fontSize,onChange:this.handleFontSizeChange}))))}}class D extends e.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidUpdate=e=>{e.theme.colors.palette.primary[700]!==this.props.theme.colors.palette.primary[700]&&this.setState({highlightColor:this.props.theme.colors.palette.primary[700]},(()=>{this.props.onGeneralSettingsUpdated("highlightColor",this.state.highlightColor)}))},this.onHighlightColorChange=e=>{this.setState({highlightColor:e},(()=>{this.props.onGeneralSettingsUpdated("highlightColor",this.state.highlightColor)}))},this.updateOnTextStyleChange=(e,t)=>{"noResultFound"===e?this.props.onGeneralSettingsUpdated("noResultMsgStyleSettings",t):this.props.onGeneralSettingsUpdated("promptTextMsgStyleSettings",t)},this.updateTextMessage=(e,t)=>{"noResultFound"===e?this.props.onGeneralSettingsUpdated("noResultsFoundText",t):this.props.onGeneralSettingsUpdated("promptTextMessage",t)},this.props.config&&(this.state={noResultsFoundMessage:this.props.config.noResultsFoundText,highlightColor:this.props.config.highlightColor?this.props.config.highlightColor:"#00FFFF",promptMessage:this.props.config.promptTextMessage})}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%",marginTop:10}},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("highlightColor"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("highlightColor")+" "+this.nls("highlightColorTooltip"),title:this.nls("highlightColorTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 mr-3 d-inline"},(0,e.jsx)(w,null))),(0,e.jsx)(C.ThemeColorPicker,{"aria-label":this.nls("highlightColor"),specificTheme:(0,L.getTheme2)(),value:this.state.highlightColor?this.state.highlightColor:"#00FFFF",onChange:e=>{this.onHighlightColorChange(e)}})),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{"aria-label":this.nls("noResultsFoundLabel"),title:this.nls("noResultsFoundLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("noResultsFoundLabel"))),(0,e.jsx)(j,{intl:this.props.intl,theme:this.props.theme,hintMessage:this.state.noResultsFoundMessage,noResultFound:"noResultFound",textStyle:this.props.config.noResultMsgStyleSettings,onTextMessageChange:this.updateTextMessage,onTextFormatChange:this.updateOnTextStyleChange})),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{"aria-label":this.nls("promptMessageLabel"),title:this.nls("promptMessageLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"w-100 flex-grow-1 setting-text-level-3"},this.nls("promptMessageLabel"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("promptMessageLabelToolTip"),title:this.nls("promptMessageLabelToolTip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 ml-2 d-inline"},(0,e.jsx)(w,null)))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(j,{intl:this.props.intl,theme:this.props.theme,hintMessage:this.state.promptMessage,promptTextMessage:"promtMessage",textStyle:this.props.config.promptTextMsgStyleSettings,onTextMessageChange:this.updateTextMessage,onTextFormatChange:this.updateOnTextStyleChange})))}}const T=[{value:"feet",label:"Feet"},{value:"meters",label:"Meters"},{value:"kilometers",label:"Kilometers"},{value:"miles",label:"Miles"},{value:"yards",label:"Yards"}],M=[d.Closest,d.Proximity,d.Summary],k="#f507f5",N="#FFFFFF00",R=[{analysisId:"",analysisType:M[0],highlightResultsOnMap:!0,highlightColorOnMap:k,expandOnOpen:!0},{analysisId:"",analysisType:M[1],displayField:"",sortFeaturesByDistance:!0,sortFeatures:{sortFeaturesByField:"",sortFeaturesOrder:"ASC"},groupFeaturesEnabled:!1,groupFeatures:{groupFeaturesByField:"",groupFeaturesOrder:"ASC"},sortGroupsByCount:!1,highlightResultsOnMap:!0,highlightColorOnMap:k,expandOnOpen:!1,expandFeatureDetails:!1},{analysisId:"",analysisType:M[2],isSingleColorMode:!0,singleFieldColor:N,summaryFields:[],highlightResultsOnMap:!0,highlightColorOnMap:k,expandOnOpen:!1}],B={analysisSettings:{layersInfo:[],displayFeatureCount:!0,displayAnalysisIcon:!1},searchSettings:{headingLabel:"",bufferDistance:1,distanceUnits:"",showDistanceSettings:!0,showSketchTools:!0,searchByActiveMapArea:!1,includeFeaturesOutsideMapArea:!1,showDistFromInputLocation:!0,onlyShowLayersResult:!1}};var E,P,V;!function(e){e.NoFormatting="noFormatting",e.Round="round",e.Truncate="truncate"}(E||(E={})),function(e){e.SumOfIntersectedArea="sumOfIntersectedArea",e.SumOfIntersectedLength="sumOfIntersectedLength"}(P||(P={})),P.SumOfIntersectedLength,E.NoFormatting,P.SumOfIntersectedArea,E.NoFormatting,function(e){e.SingleColor="singleColor",e.ByCategory="byCategory"}(V||(V={}));const U=["#5E8FD0","#77B484","#DF6B35","#DBCF4E","#41546D","#8257C2","#D6558B"],G=[U,["#596A90","#85C2E4","#DEB3D9","#9FB6E1","#BBE4EF","#C5B2E1","#8482D0"],["#A6382F","#47707A","#F0CF35","#D18332","#B9C143","#E38B67","#AAC86A"],["#E49DAF","#B1F2D0","#F5F49A","#94CAFC","#E9C7A3","#C9A7E8","#DDF3AA"],["#004CA3","#005ECA","#076FE5","#2C8FFF","#65ADFF","#ACD3FF","#E6F2FF"],["#7D5D00","#AA7F00","#DDA400","#FFC300","#FFCE2F","#FFDE72","#FFEDB1"],["#4E427E","#6A5A9E","#8E7AC3","#A293D9","#B0A3E7","#C4B7EB","#DFD9F1"],["#BA4300","#ED5500","#FF7121","#FF8D4C","#FFA878","#FFC4A3","#FFE0CE"]];class W extends e.React.PureComponent{constructor(t){if(super(t),this.nls=e=>{var t;const s=Object.assign({},l,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onHeadingLabelChange=e=>{this.setState({headingLabelText:e})},this.onHeadingLabelAcceptValue=()=>{this.props.onSearchSettingsUpdated("headingLabel",this.state.headingLabelText)},this.onIncludeFeaturesMapAreaToggleChange=e=>{this.setState({includeFeaturesMapAreaOption:e.target.checked},(()=>{this.props.onSearchSettingsUpdated("includeFeaturesOutsideMapArea",this.state.includeFeaturesMapAreaOption),this.setState({headingLabelText:e.target.checked?this.nls("disabledDefineSearchAreaLabel"):this.nls("currentMapAreaLabel")},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("headingLabel",this.state.headingLabelText)}),100)}))}))},this.onDistanceUnitChange=e=>{const t=((e,t)=>{const s=f(t);return e>s?s:e})(this.state.bufferDistance,e.target.value);this.props.onSearchSettingsUpdated("bufferDistance",t),this.setState({distanceUnits:e.target.value,bufferDistance:t},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("distanceUnits",this.state.distanceUnits)}),50)}))},this.onBufferDistanceChange=e=>{this.setState({bufferDistance:null!=e?e:1},(()=>{this.props.onSearchSettingsUpdated("bufferDistance",this.state.bufferDistance)}))},this.handleSearchByChange=e=>{let t="";t=e?this.state.includeFeaturesMapAreaOption?this.nls("disabledDefineSearchAreaLabel"):this.nls("currentMapAreaLabel"):this.nls("locationLabel"),this.setState({headingLabelText:t},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("headingLabel",this.state.headingLabelText)}),100)})),this.props.onSearchSettingsUpdated("searchByActiveMapArea",e)},this.onShowDistanceSettingsChange=e=>{this.setState({showDistanceSettings:e.target.checked},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("showDistanceSettings",this.state.showDistanceSettings)}),50)}))},this.onShowSketchToolsSettingsChange=e=>{this.setState({showSketchTools:e.target.checked},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("showSketchTools",this.state.showSketchTools)}),50)}))},this.onShowDistFromInputLocToolsChange=e=>{this.setState({showDistFromInputLocation:e.target.checked},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("showDistFromInputLocation",this.state.showDistFromInputLocation)}),50)}))},this.onlyShowResultsOptionChange=e=>{this.setState({showLayersResultOption:e.target.checked},(()=>{this.props.onSearchSettingsUpdated("onlyShowLayersResult",this.state.showLayersResultOption)}))},this.props.config){const t=""!==this.props.config.distanceUnits?this.props.config.distanceUnits:(()=>{const t=(0,e.getAppStore)().getState().portalSelf;return"english"===(null==t?void 0:t.units)?"miles":"kilometers"})();this.state={headingLabelText:this.props.config.headingLabel,bufferDistance:this.props.config.bufferDistance,distanceUnits:t,showDistanceSettings:this.props.config.showDistanceSettings,showSketchTools:this.props.config.showSketchTools,includeFeaturesMapAreaOption:this.props.config.includeFeaturesOutsideMapArea,showDistFromInputLocation:this.props.config.showDistFromInputLocation,showLayersResultOption:this.props.config.onlyShowLayersResult}}}render(){return(0,e.jsx)("div",{css:(s=this.props.theme,e.css`
    .cursor-pointer {
      cursor: pointer;
    }

    .switchLabelWidth {
      width: calc(100% - 28px);
    }

    .nm-divider-top {
      border-top: 1px solid var(--light-800)
    }

    .color-label {
      color: ${s.colors.palette.dark[400]};
    }

    .onlyShowResultsLabel {
      width: calc(100% - 52px);
    }
  `),style:{height:"100%",width:"100%"}},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("defineSearchAreaLabel"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("defineSearchAreaLabel")+" "+this.nls("defineSearchAreaTooltip"),title:this.nls("defineSearchAreaTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(w,null)))),(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{className:"mt-3",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("searchByActiveMapArea"),className:"cursor-pointer",value:"searchByActiveMapArea",onChange:()=>{this.handleSearchByChange(!0)},checked:this.props.config.searchByActiveMapArea}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{!this.props.config.searchByActiveMapArea&&this.handleSearchByChange(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSearchByChange(!0)}},this.nls("searchByActiveMapArea")))),(0,e.jsx)(t.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("searchByLocation"),className:"cursor-pointer",value:"searchByLocation",onChange:()=>{this.handleSearchByChange(!1)},checked:!this.props.config.searchByActiveMapArea}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.props.config.searchByActiveMapArea&&this.handleSearchByChange(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSearchByChange(!1)}},this.nls("searchByLocation")))),(0,e.jsx)(t.SettingRow,{label:this.nls("headingLabel"),className:"ml-2",flow:"wrap"},(0,e.jsx)(i.TextArea,{tabIndex:0,className:"w-100",spellCheck:!1,value:this.state.headingLabelText,onChange:e=>{this.onHeadingLabelChange(e.target.value)},onAcceptValue:this.onHeadingLabelAcceptValue})),this.props.config.searchByActiveMapArea&&(0,e.jsx)(t.SettingRow,{className:"ml-2",label:this.nls("featuresOutsideMapArea")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("featuresOutsideMapArea"),title:this.nls("featuresOutsideMapArea"),checked:this.state.includeFeaturesMapAreaOption,onChange:this.onIncludeFeaturesMapAreaToggleChange})),this.state.includeFeaturesMapAreaOption&&this.props.config.searchByActiveMapArea&&(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("searchAreaHint"),className:"font-italic w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("searchAreaHint")))),!this.props.config.searchByActiveMapArea&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{className:"mt-3 ml-2",flow:"wrap"},(0,e.jsx)(i.Label,{title:this.nls("bufferDistance"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("bufferDistance"))),(0,e.jsx)(i.NumericInput,{"aria-label":this.nls("bufferDistance"),style:{width:"240px"},size:"sm",min:0,max:f(this.state.distanceUnits),defaultValue:this.state.bufferDistance,value:this.state.bufferDistance,onChange:this.onBufferDistanceChange})),(0,e.jsx)(t.SettingRow,{className:"ml-2",flow:"wrap"},(0,e.jsx)(i.Label,{title:this.nls("distanceUnits"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("distanceUnits"))),(0,e.jsx)(i.Select,{style:{marginBottom:"1px"},"aria-label":this.nls("distanceUnits")+" "+this.state.distanceUnits,size:"sm",value:this.state.distanceUnits,onChange:e=>{this.onDistanceUnitChange(e)}},T.map(((t,s)=>(0,e.jsx)(i.Option,{role:"option",tabIndex:0,"aria-label":t.label,value:t.value,key:s},t.label))))),(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("showDistanceSettings"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showDistanceSettings,onChange:this.onShowDistanceSettingsChange.bind(this)}),this.nls("showDistanceSettings"))),(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("showDistFromInputLoc"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showDistFromInputLocation,onChange:this.onShowDistFromInputLocToolsChange.bind(this)}),this.nls("showDistFromInputLoc"))),(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("showSketchTools"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showSketchTools,onChange:this.onShowSketchToolsSettingsChange.bind(this)}),this.nls("showSketchTools"))),(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{className:"onlyShowResultsLabel d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 mr-2 text-break setting-text-level-3"},this.nls("onlyShowResults"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("onlyShowResults")+" "+this.nls("onlyShowResultsTooltip"),title:this.nls("onlyShowResultsTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 mr-2 d-inline"},(0,e.jsx)(w,null))),(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("onlyShowResults"),title:this.nls("onlyShowResults"),checked:this.state.showLayersResultOption,onChange:this.onlyShowResultsOptionChange})))));var s}}var z=m(55339),_=m.n(z);const H=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:_()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var J=m(59587),Z=m(79964),$=m.n(Z);const K=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:$()},a)):e.React.createElement("svg",Object.assign({className:l},a))};class Y extends e.React.PureComponent{constructor(t){super(t),this.analysisSettingPopperTrigger=e.React.createRef(),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{1===this.state.addedLayerAnalysis.length&&this.setState({selectedAnalysis:this.props.addedLayerAnalysis.length-1})},this.componentDidUpdate=e=>{var t,s,i,a;(null===(t=null==e?void 0:e.addedLayerAnalysis)||void 0===t?void 0:t.length)!==(null===(i=null===(s=this.props)||void 0===s?void 0:s.addedLayerAnalysis)||void 0===i?void 0:i.length)&&this.setState({addedLayerAnalysis:this.props.addedLayerAnalysis,selectedAnalysis:this.props.addedLayerAnalysis.length-1}),(null==e?void 0:e.addedLayerAnalysis)!==(null===(a=this.props)||void 0===a?void 0:a.addedLayerAnalysis)&&this.setState({addedLayerAnalysis:this.props.addedLayerAnalysis})},this.onAnalysisOrderChanged=e=>{let t=-1;this.props.editCurrentLayer&&(t=e.findIndex((e=>{var t;return(null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===this.props.editCurrentLayer.analysisType})),this.setState({selectedAnalysis:t})),this.setState({addedLayerAnalysis:e},(()=>{this.props.onLayersInfoSettingsUpdated(this.state.addedLayerAnalysis,this.props.analysisIndex,this.props.editCurrentLayer.layerDsId,this.props.editCurrentLayer.analysisType)}))},this.onEditAction=(e,t,s)=>{this.props.onEditAction(!0,e,t,s),this.state.addedLayerAnalysis.some(((e,t)=>s===t&&(this.setState({selectedAnalysis:s}),!0)))},this.onRemoveAction=(e,t,s,i)=>{e.stopPropagation();const a=this.state.addedLayerAnalysis;a.splice(i,1);let l=-1;this.props.editCurrentLayer&&(l=a.findIndex((e=>e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===this.props.editCurrentLayer.analysisType)),this.setState({selectedAnalysis:l})),this.setState({addedLayerAnalysis:a},(()=>{this.props.onDeleteAction(this.state.addedLayerAnalysis,t,s,l)}))},this.createAnalysisItem=(t,s)=>{var a,l;return(0,e.jsx)("div",{className:(0,e.classNames)("flex-grow-1 analysis-item cursor-pointer"),key:s},(0,e.jsx)("div",{className:"d-flex w-100 justify-content-between align-items-center"},(0,e.jsx)("div",{className:"layer-analysis-name text-truncate",title:t.label},t.label),this.props.isActiveMapAreaSelected&&t.analysisInfo.analysisType===d.Closest&&(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("warningMsgIfActiveMapArea"),title:this.nls("warningMsgIfActiveMapArea"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(K,{color:"var(--warning-700)"}))),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("deleteOption"),title:this.nls("deleteOption"),type:"tertiary",size:"sm",icon:!0,onClick:e=>{this.onRemoveAction(e,t.useDataSource.dataSourceId,t.analysisInfo.analysisType,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onRemoveAction(e,t.useDataSource.dataSourceId,t.analysisInfo.analysisType,s)}},(0,e.jsx)(H,{size:"s",className:"p-0"}))),(0,e.jsx)("div",{className:"text-dark-600 d-flex align-items-center analysis-type-name"},(0,e.jsx)("div",{className:"w-100 text-truncate",title:this.nls(null===(a=null==t?void 0:t.analysisInfo)||void 0===a?void 0:a.analysisType)},this.nls(null===(l=null==t?void 0:t.analysisInfo)||void 0===l?void 0:l.analysisType))))},this.getLayersInfoList=()=>{var t;return(0,e.jsx)("div",{className:"nearme-analysis-list-items"},(0,e.jsx)(J.List,{itemsJson:null===(t=Array.from(this.state.addedLayerAnalysis?this.state.addedLayerAnalysis:null))||void 0===t?void 0:t.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:this.props.showEditAnalysisPopper&&this.state.selectedAnalysis===t}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s,a=i.map((e=>e.itemStateDetailContent));this.onAnalysisOrderChanged(a)},onClickItemBody:(e,t)=>{var s;const{itemJsons:i}=t.props,a=i[0],l=i[1],n=a.itemStateDetailContent;this.onEditAction(null===(s=null==n?void 0:n.useDataSource)||void 0===s?void 0:s.dataSourceId,n.analysisInfo.analysisType,l.indexOf(a))},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:J.TreeItemActionType.RenderOverrideItem,children:[{name:J.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:J.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:J.TreeItemActionType.RenderOverrideItemBody,children:[{name:J.TreeItemActionType.RenderOverrideItemDragHandle},{name:J.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createAnalysisItem(i.itemStateDetailContent,a.indexOf(i))}}))},this.state={selectedAnalysis:this.props.analysisIndex?this.props.analysisIndex:-1,addedLayerAnalysis:this.props.addedLayerAnalysis}}render(){return(0,e.jsx)(e.React.Fragment,null,this.getLayersInfoList())}}var q=m(59216),Q=m.n(q);const X=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:Q()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var ee=m(41553),te=m.n(ee);const se=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:te()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var ie=m(11407),ae=m.n(ie);const le=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:ae()},a)):e.React.createElement("svg",Object.assign({className:l},a))};class ne extends e.React.PureComponent{constructor(){super(...arguments),this.backRef=e.React.createRef(),this.nls=t=>{var s;const a=Object.assign({},l,i.defaultMessages,e.defaultMessages);return(null===(s=this.props.intl)||void 0===s?void 0:s.formatMessage)?this.props.intl.formatMessage({id:t,defaultMessage:a[t]}):a[t]},this.backRefFocus=()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.backRef)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),50)},this.onOkButtonClick=()=>{this.props.onOkButtonClicked()}}getStyle(t){var s,i,a;return e.css`
      .setting-header {
        padding: ${e.polished.rem(18)} ${e.polished.rem(16)} ${e.polished.rem(0)} ${e.polished.rem(16)}
      }

      .setting-title {
        font-size: ${e.polished.rem(16)};
        color: ${null===(a=null===(i=null===(s=null==t?void 0:t.colors)||void 0===s?void 0:s.palette)||void 0===i?void 0:i.dark)||void 0===a?void 0:a[600]}
      }

      .commonOkButton {
        padding: 9px 17px 0px 17px;
      }

      .hideCursorPointer {
        cursor: default;
      }
    `}render(){return(0,e.jsx)("div",{tabIndex:-1,className:"w-100 h-100",css:this.getStyle(this.props.theme)},(0,e.jsx)("div",{tabIndex:-1,className:"w-100 d-flex align-items-center justify-content-between setting-header border-0",style:{height:"38px",marginBottom:"20px"}},this.props.hideBackArrow?(0,e.jsx)("div",{"aria-label":this.props.title,className:"setting-title mt-1",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title},this.props.title):(0,e.jsx)("div",{tabIndex:-1,className:"h-100"},(0,e.jsx)("div",{ref:this.backRef,tabIndex:0,className:"d-flex align-items-center h-100",style:{cursor:"pointer"},onClick:this.props.onBack,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.props.onBack()}},(0,e.jsx)("div",{className:"d-flex align-items-center",title:this.nls("back"),"aria-label":this.nls("back")},(0,e.jsx)(le,{autoFlip:!0,size:"14",className:"text-dark"})),(0,e.jsx)("div",{"aria-label":this.props.title,className:"pl-2 setting-title",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title},this.props.title))),this.props.showCloseIcon&&(0,e.jsx)(i.Button,{role:"button","aria-label":this.props.title+" "+this.nls("close"),title:this.nls("close"),size:"sm",icon:!0,type:"tertiary",onClick:this.props.onBack},(0,e.jsx)(H,{autoFlip:!0,size:"14",className:"text-dark"}))),this.props.children,this.props.showOkButton&&(0,e.jsx)("div",{className:"commonOkButton"},(0,e.jsx)(i.Button,{role:"button",className:(0,e.classNames)("w-100 text-dark",this.props.disableOkButton?"hideCursorPointer":""),type:"primary",disabled:this.props.disableOkButton,onClick:this.onOkButtonClick.bind(this)},this.nls("commonModalOk"))))}}const oe=e.css`
  padding: 12px 0px;
  .jimu-dropdown-item {
    padding: 4px 16px !important;
    &:hover {
      background-color: var(--light-500) !important;
    }
  }
`,re=e.css`
  display: flex;
  width: 100%;
  > .color-item {
    width: 30px;
    height: 16px;
  }
`;class de extends e.React.PureComponent{constructor(t){super(t),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.setState({colorUpdate:this.getFieldsColor()})},this.componentDidUpdate=e=>{if(e.summaryFieldsInfo!==this.props.summaryFieldsInfo){const e=Object.assign({},this.state.colorUpdate);this.props.summaryFieldsInfo.forEach(((t,s)=>{e[t.fieldLabel+"_"+s]={_fieldLabel:t.fieldLabel,_fillColor:t.fieldColor}})),this.setState({colorUpdate:e})}},this.getFieldsColor=()=>{const e={};return this.props.summaryFieldsInfo.forEach(((t,s)=>{e[t.fieldLabel+"_"+s]={_fieldLabel:t.fieldLabel,_fillColor:t.fieldColor===N?this.state.colorStrip[s%this.state.colorStrip.length]:t.fieldColor}})),e},this.onStripColorChange=(t,s)=>{t.stopPropagation();const i=((t,s)=>{if(!s)return;let i=(0,e.Immutable)({});return Object.entries(t).forEach((([e,t],a)=>{const l=((e,t=0)=>{if(null==e?void 0:e.length)return e[t%e.length]})(s,a),n=Object.assign({},t);n._fillColor=l,i=i.set(e,n)})),i})(this.state.colorUpdate,s);this.setState({colorUpdate:i,colorStrip:s},(()=>{this.props.updateFieldColorsValues(i,s)}))},this.onIndividualFieldColorChange=(e,t)=>{const s=Object.assign({},this.state.colorUpdate);s[e]={_fillColor:t},this.setState({colorUpdate:s},(()=>{this.props.updateFieldColorsValues(s,this.state.colorStrip)}))},this.state={colorUpdate:null,colorStrip:this.props.colorstripValue?this.props.colorstripValue:U}}render(){var t;return(0,e.jsx)("div",{style:{width:"100%",overflow:"auto"},css:r},(0,e.jsx)("div",{className:"color-list pt-1 px-3"},this.state.colorUpdate&&(null===(t=Object.entries(this.state.colorUpdate))||void 0===t?void 0:t.map((([t,s],a)=>{const l=s;return(0,e.jsx)("div",{className:"mb-2 colorItemStyle",key:a},(0,e.jsx)(i.Label,{check:!0},(0,e.jsx)("span",{className:"label text-truncate",title:l._fieldLabel},l._fieldLabel),(0,e.jsx)(C.ThemeColorPicker,{"aria-label":l._fieldLabel,specificTheme:(0,L.getTheme2)(),value:l._fillColor,onChange:e=>{this.onIndividualFieldColorChange(t,e)}})))})))),(0,e.jsx)("div",{className:"footer"},(0,e.jsx)("div",{className:"px-3",style:{marginTop:"14px"}},(0,e.jsx)(i.Dropdown,{className:"w-100"},(0,e.jsx)(i.DropdownButton,{size:"sm",title:this.nls("applyColors")},this.nls("applyColors")),(0,e.jsx)(i.DropdownMenu,{showArrow:!0,css:oe},(0,e.jsx)("div",{tabIndex:0},G.map(((t,s)=>(0,e.jsx)(i.DropdownItem,{tabIndex:0,className:"my-1",key:s,onClick:e=>{var s;null===(s=this.onStripColorChange)||void 0===s||s.call(this,e,t)},onKeyDown:e=>{var s;"Enter"!==e.key&&" "!==e.key||null===(s=this.onStripColorChange)||void 0===s||s.call(this,e,t)}},(0,e.jsx)("div",{tabIndex:0,"aria-label":this.nls("colorStrip")+s,css:re},t.map(((t,s)=>(0,e.jsx)("div",{className:"color-item",key:s,style:{backgroundColor:t}})))))))))))))}}var he=m(338),pe=m(58959),ce=m.n(pe);const ue=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:ce()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var me=m(99820),ye=m.n(me);const ge=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:ye()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var fe=m(39342);class Se extends e.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.handleExpressionChange=e=>{null!=e&&(e.parts.forEach((e=>{var t;e.dataSourceId&&(e.dataSourceId=null===(t=this.state.useDataSource)||void 0===t?void 0:t[0].dataSourceId)})),this.setState({updatedFieldExpression:e}),this.updateSummaryField(e.name,e))},this.updateSummaryField=(e,t)=>{const s={fieldLabel:e,selectedExpression:t};this.props.expressionInfoUpdate(s)};const t=u(this.props.currentLayerDsId.layerDsId),s=[{dataSourceId:t.id,mainDataSourceId:t.id,rootDataSourceId:t.parentDataSource.id}];this.state={useDataSource:s,updatedFieldExpression:null!==this.props.fieldsEditIndex?this.props.editingField.summaryFieldInfo:null}}render(){var t;return(0,e.jsx)(fe.ExpressionBuilder,{className:"p-2",css:(this.props.theme,e.css`
    .component-main-data-and-view {
      display: none;
    }

    .component-expression-builder .expression-editor-helper {
      height: calc(100% - 25px)!important;
    }

    .component-expression-builder .statistics-tab div {
      padding-top: 0px!important;
    }

    .expression-editor-container div {
      padding: 0px!important;
    }

    .component-expression-editor .exp-editor-helper-tab {
      margin-left: 0px!important;
      margin-right: 0px!important;
    }

    .component-field-selector .item-selector-search {
      margin-top: 18px!important;
    }
  `),fieldTypes:(0,e.Immutable)([e.JimuFieldType.Number]),widgetId:this.props.widgetId,types:(0,e.Immutable)([fe.ExpressionBuilderType.Statistics,fe.ExpressionBuilderType.Expression]),useDataSources:(0,e.Immutable)([null===(t=this.state.useDataSource)||void 0===t?void 0:t[0]]),expression:this.state.updatedFieldExpression,onChange:this.handleExpressionChange})}}class xe extends e.React.PureComponent{constructor(e){var t,s,a,n;super(e),this.nls=e=>{var t;const s=Object.assign({},l,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onFieldLabelChange=e=>{const t=e.target.value;this.setState({summaryFieldLabel:t})},this.onFieldLabelAcceptValue=e=>{this.setState({summaryFieldLabel:e.trim()})},this.onOkButtonClicked=()=>{""!==this.state.summaryFieldLabel&&(this.setState({isEditSummaryPopperActive:!1}),this.props.onOkClick(this.state.summaryFieldLabel,this.state.showThousandSeparator,this.state.formattingOptions,this.state.significantDigit),this.props.onClose())},this.onCancelButtonClicked=()=>{this.setState({isEditSummaryPopperActive:!1}),this.props.onClose()},this.onSeparatorChange=e=>{this.setState({showThousandSeparator:e.target.checked})},this.handleFormattingChange=e=>{this.setState({formattingOptions:e.target.value}),e.target.value!==E.Round&&e.target.value!==E.Truncate||this.setState({significantDigit:2})},this.onDigitsChange=e=>{const t=Math.floor(e);this.setState({significantDigit:t})},this.state={isEditSummaryPopperActive:this.props.isOpen,showThousandSeparator:null===(t=this.props.editSummaryFields.summaryFieldInfo)||void 0===t?void 0:t.showSeparator,summaryFieldLabel:null===(s=this.props.editSummaryFields)||void 0===s?void 0:s.fieldLabel,formattingOptions:null===(a=this.props.editSummaryFields.summaryFieldInfo)||void 0===a?void 0:a.numberFormattingOption,significantDigit:null===(n=this.props.editSummaryFields.summaryFieldInfo)||void 0===n?void 0:n.significantDigits}}render(){const t=e.css`
      .hidden{
        display: none;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      .separatorSwitch {
        margin-left: 130px;
      }

      .modal-content  {
        background: var(--light-300);
      }

      .invalid-value {
        border: 1px solid  ${this.props.theme.colors.danger};
        box-shadow: 0 0 5px  ${this.props.theme.colors.danger};
      }
    `;return(0,e.jsx)("div",null,(0,e.jsx)(i.AlertPopup,{css:t,"aria-expanded":this.state.isEditSummaryPopperActive,isOpen:this.state.isEditSummaryPopperActive,onClickOk:this.onOkButtonClicked.bind(this),onClickClose:this.onCancelButtonClicked.bind(this),title:this.props.sumOfIntersectedFieldPopupTitle},(0,e.jsx)("table",{cellPadding:10},(0,e.jsx)("tbody",null,(0,e.jsx)("tr",null,(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"mt-2"},this.nls("label"))),(0,e.jsx)("td",{colSpan:2},(0,e.jsx)(i.TextInput,{role:"textbox","aria-label":this.nls("label")+this.state.summaryFieldLabel,size:"sm",title:this.state.summaryFieldLabel,className:""===this.state.summaryFieldLabel?"invalid-value":"",value:this.state.summaryFieldLabel,onAcceptValue:this.onFieldLabelAcceptValue,onChange:this.onFieldLabelChange}))),(0,e.jsx)("tr",null,(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"mt-2"},this.nls("showSeparator"))),(0,e.jsx)("td",{colSpan:2},(0,e.jsx)(i.Switch,{className:"separatorSwitch",role:"switch","aria-label":this.nls("showSeparator"),title:this.nls("showSeparator"),checked:this.state.showThousandSeparator,onChange:this.onSeparatorChange}))),(0,e.jsx)("tr",null,(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("noFormatting"),className:"cursor-pointer",value:"noFormatting",onChange:e=>{this.handleFormattingChange(e)},checked:"noFormatting"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer"},this.nls("noFormatting")))),(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("round"),className:"cursor-pointer",value:"round",onChange:e=>{this.handleFormattingChange(e)},checked:"round"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer"},this.nls("round")))),(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("truncate"),className:"cursor-pointer",value:"truncate",onChange:e=>{this.handleFormattingChange(e)},checked:"truncate"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer"},this.nls("truncate"))))),"noFormatting"!==this.state.formattingOptions&&(0,e.jsx)("tr",null,(0,e.jsx)("td",{tabIndex:0,"aria-label":this.nls("significantDigitsLabel")},(0,e.jsx)(i.Label,null,this.nls("significantDigitsLabel"))),(0,e.jsx)("td",{colSpan:2},(0,e.jsx)(i.NumericInput,{"aria-label":this.nls("significantDigitsLabel"),className:"significantDigitsLabel",size:"sm",min:0,max:10,defaultValue:this.state.significantDigit,value:this.state.significantDigit,onChange:this.onDigitsChange})))))))}}const be=m(17e3);let ve=[];class Ce extends e.React.PureComponent{constructor(t){super(t),this.supportedDsTypes=(0,e.Immutable)([he.AllDataSourceTypes.FeatureLayer]),this.items=[],this.backRef=e.React.createRef(),this.colorSidePopperTrigger=e.React.createRef(),this.colorButtonRef=e.React.createRef(),this.addSummaryFieldsRef=e.React.createRef(),this.summaryFieldsSidePopperTrigger=e.React.createRef(),this.allSelectedLayers=[],this.defaultSelectedItem={name:""},this.nls=e=>{var t;const s=Object.assign({},l,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.props.availableFeatureLayer.forEach(((e,t)=>{this.getLayerListProperty(e.id)})),this.setState({selectedLayers:this.allSelectedLayers}),this.editValueUpdate(!1)},this.getLayerListProperty=e=>{const t=u(e);if(t){const e={label:t.getLabel(),layer:{layerDsId:t.id}};this.allSelectedLayers.push(e)}},this.componentDidUpdate=(t,s)=>{this.props.editCurrentLayer.layerDsId===t.editCurrentLayer.layerDsId&&this.props.analysisIndex===t.analysisIndex&&e.lodash.isDeepEqual(this.props.analysisList,t.analysisList)||this.editValueUpdate(!1),e.lodash.isDeepEqual(this.state.analysisListSettings,s.analysisListSettings)||this.editValueUpdate(!0)},this.intersectedAreaLengthField=(e,t)=>(e.push({fieldLabel:t.fieldLabel,fieldColor:t.fieldColor,summaryFieldInfo:{summaryBy:t.summaryFieldInfo.summaryBy,showSeparator:t.summaryFieldInfo.showSeparator,numberFormattingOption:t.summaryFieldInfo.numberFormattingOption,significantDigits:t.summaryFieldInfo.significantDigits}}),e),this.setSummaryValues=e=>{let t=[];e.summaryFields.forEach((e=>{var s,i;this.setState({singleColorFields:e.fieldColor}),(null===(s=e.summaryFieldInfo)||void 0===s?void 0:s.summaryBy)===P.SumOfIntersectedArea?(t=this.intersectedAreaLengthField(t,e),this.setState({sumOfAreaLabel:e.fieldLabel,sumOfArea:!0,intersectedSummaryFieldList:t})):(null===(i=e.summaryFieldInfo)||void 0===i?void 0:i.summaryBy)===P.SumOfIntersectedLength?(t=this.intersectedAreaLengthField(t,e),this.setState({sumOfLengthLabel:e.fieldLabel,sumOfLength:!0,intersectedSummaryFieldList:t})):ve.push({fieldLabel:e.fieldLabel,fieldColor:e.fieldColor,summaryFieldInfo:e.summaryFieldInfo})}))},this.editValueUpdate=e=>{ve=[],this.getFieldsDs(this.props.editCurrentLayer.layerDsId),(e?this.state.analysisListSettings:this.props.analysisList).forEach(((e,t)=>{var s,i,a,l,n;const o=e.analysisInfo,r=u(null===(s=e.useDataSource)||void 0===s?void 0:s.dataSourceId);if((null===(i=null==e?void 0:e.useDataSource)||void 0===i?void 0:i.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===d.Closest&&this.props.analysisIndex===t)return this.props.disableOkButton(e.analysisInfo.analysisType===d.Closest&&this.props.isActiveMapAreaSelected),this.setState({closestAnalysisType:!0,proximityAnalysisType:!1,summaryAnalysisType:!1,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,highlightResultsOnMap:o.highlightResultsOnMap,highlightColorOnMap:o.highlightColorOnMap,expandOnOpen:o.expandOnOpen}),!0;if((null===(a=e.useDataSource)||void 0===a?void 0:a.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===d.Proximity&&this.props.analysisIndex===t)return this.props.disableOkButton(!1),this.setState({closestAnalysisType:!1,proximityAnalysisType:!0,summaryAnalysisType:!1,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,displayField:o.displayField?[o.displayField]:[x(null==r?void 0:r.layerDefinition)],sortFeaturesByDistance:o.sortFeaturesByDistance,sortFeaturesField:o.sortFeatures.sortFeaturesByField?[o.sortFeatures.sortFeaturesByField]:[],sortFeaturesFieldOrder:o.sortFeatures.sortFeaturesOrder,isGroupFeatures:o.groupFeaturesEnabled,groupFeaturesField:o.groupFeatures.groupFeaturesByField?[o.groupFeatures.groupFeaturesByField]:[],groupFeaturesFieldOrder:o.groupFeatures.groupFeaturesOrder,isSortGroupsByCount:o.sortGroupsByCount,expandOnOpen:o.expandOnOpen,expandFeatureDetails:o.expandFeatureDetails,highlightResultsOnMap:o.highlightResultsOnMap,highlightColorOnMap:o.highlightColorOnMap}),!0;if((null===(l=e.useDataSource)||void 0===l?void 0:l.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===d.Summary&&this.props.analysisIndex===t){this.props.disableOkButton(!1),this.setEditIndex=t;const s=u(this.props.editCurrentLayer.layerDsId);return this.updateSummaryFieldListSettings=o.summaryFields,o.summaryFields.length>0&&this.setSummaryValues(o),this.setState({closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!0,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,singleColorMode:o.isSingleColorMode,colorstripValues:o.selectedColorStrip||U,singleColorFields:o.summaryFields.length>0?o.singleFieldColor:N,summaryFieldsList:ve,selectedLayerGeometry:null===(n=null==s?void 0:s.layerDefinition)||void 0===n?void 0:n.geometryType,expandOnOpen:o.expandOnOpen,highlightResultsOnMap:o.highlightResultsOnMap,highlightColorOnMap:o.highlightColorOnMap}),!0}}))},this.updateItemValue=(e,t,s)=>{let i;this.state.analysisListSettings.some(((a,l)=>{var n,o,r;const h=u((null==s?void 0:s.dataSourceId)?null==s?void 0:s.dataSourceId:this.props.editCurrentLayer.layerDsId);return(null===(n=null==a?void 0:a.useDataSource)||void 0===n?void 0:n.dataSourceId)!==(null==s?void 0:s.dataSourceId)&&!this.props.editCurrentLayer.layerDsId||this.state.analysisType!==d.Closest||this.props.analysisIndex!==l?(null===(o=a.useDataSource)||void 0===o?void 0:o.dataSourceId)!==(null==s?void 0:s.dataSourceId)&&!this.props.editCurrentLayer.layerDsId||this.state.analysisType!==d.Proximity||this.props.analysisIndex!==l?(null===(r=a.useDataSource)||void 0===r?void 0:r.dataSourceId)!==(null==s?void 0:s.dataSourceId)&&!this.props.editCurrentLayer.layerDsId||this.state.analysisType!==d.Summary||this.props.analysisIndex!==l?void 0:(this.setEditIndex=l,this.updateSummaryFieldListSettings=this.state.summaryFieldsList.concat(this.state.intersectedSummaryFieldList),i={useDataSource:e?s:a.useDataSource,label:e?t:a.label,analysisInfo:{analysisId:a.analysisInfo.analysisId,analysisType:this.state.analysisType,isSingleColorMode:this.state.singleColorMode,singleFieldColor:this.state.singleColorFields,selectedColorStrip:this.state.colorstripValues,summaryFields:this.updateSummaryFieldListSettings,expandOnOpen:this.state.expandOnOpen,highlightResultsOnMap:this.state.highlightResultsOnMap,highlightColorOnMap:this.state.highlightColorOnMap}},!0):(this.setEditIndex=l,i={useDataSource:e?s:a.useDataSource,label:e?t:a.label,analysisInfo:{analysisId:a.analysisInfo.analysisId,analysisType:this.state.analysisType,displayField:this.state.displayField.length>0?this.state.displayField[0]:x(null==h?void 0:h.layerDefinition),sortFeaturesByDistance:this.state.sortFeaturesByDistance,sortFeatures:{sortFeaturesByField:this.state.sortFeaturesField.length>0?this.state.sortFeaturesField[0]:"",sortFeaturesOrder:this.state.sortFeaturesFieldOrder},groupFeaturesEnabled:this.state.isGroupFeatures,groupFeatures:{groupFeaturesByField:this.state.groupFeaturesField.length>0?this.state.groupFeaturesField[0]:"",groupFeaturesOrder:this.state.groupFeaturesFieldOrder},sortGroupsByCount:this.state.isSortGroupsByCount,expandOnOpen:this.state.expandOnOpen,expandFeatureDetails:this.state.expandFeatureDetails,highlightResultsOnMap:this.state.highlightResultsOnMap,highlightColorOnMap:this.state.highlightColorOnMap}},!0):(this.setEditIndex=l,i={useDataSource:e?s:a.useDataSource,label:e?t:a.label,analysisInfo:{analysisId:a.analysisInfo.analysisId,analysisType:this.state.analysisType,expandOnOpen:this.state.expandOnOpen,highlightResultsOnMap:this.state.highlightResultsOnMap,highlightColorOnMap:this.state.highlightColorOnMap}},!0)})),this.updateItem(this.setEditIndex,i,(null==s?void 0:s.dataSourceId)||this.props.editCurrentLayer.layerDsId,this.state.analysisType)},this.updateItem=(e,t,s,i)=>{const a=e;if(a>-1){const e=[...this.props.analysisList.slice(0,a),Object.assign({},this.props.analysisList[a],t),...this.props.analysisList.slice(a+1)];this.props.onAnalysisUpdate(e,s,i,a),this.setState({analysisListSettings:e})}},this.onAnalysisTypeChange=e=>{this.props.disableOkButton(!1),e===d.Closest?this.setState({closestAnalysisType:!0,proximityAnalysisType:!1,summaryAnalysisType:!1,expandOnOpen:!0}):e===d.Proximity?this.setState({closestAnalysisType:!1,proximityAnalysisType:!0,summaryAnalysisType:!1,expandOnOpen:!1,expandFeatureDetails:!1}):this.setState({closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!0,expandOnOpen:!1}),this.resetAnalysisValues(this.state.useDataSource),this.setState({analysisType:e},(()=>{this.updateItemValue()}))},this.onLayerLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({layerLabel:t})}},this.onLayerLabelAcceptValue=e=>{this.updateItemValue(!0,e,this.state.useDataSource)},this.handleSortFeaturesOptionsChange=e=>{this.setState({sortFeaturesByDistance:e},(()=>{this.updateItemValue()}))},this.onDisplayField=e=>{0===e.length?this.setState({displayField:[]},(()=>{this.updateItemValue()})):this.setState({displayField:[e[0].jimuName]},(()=>{this.updateItemValue()}))},this.onSortFieldSelectChange=e=>{0===e.length?this.setState({sortFeaturesField:[]},(()=>{this.updateItemValue()})):this.setState({sortFeaturesField:[e[0].jimuName]},(()=>{this.updateItemValue()}))},this.onGroupFieldSelectChange=e=>{0===e.length?this.setState({groupFeaturesField:[]},(()=>{this.updateItemValue()})):this.setState({groupFeaturesField:[e[0].jimuName]},(()=>{this.updateItemValue()}))},this.expandListOnChange=e=>{!e.target.checked&&this.state.proximityAnalysisType&&this.setState({expandFeatureDetails:!1}),this.setState({expandOnOpen:e.target.checked},(()=>{this.updateItemValue()}))},this.resetAnalysisValues=t=>{var s;const i=u(t.dataSourceId);this.setState({displayField:[],sortFeaturesByDistance:!0,sortFeaturesField:[],sortFeaturesFieldOrder:e.OrderRule.Asc,isGroupFeatures:!1,groupFeaturesField:[],groupFeaturesFieldOrder:e.OrderRule.Asc,isSortGroupsByCount:!1,selectedLayerGeometry:null===(s=null==i?void 0:i.layerDefinition)||void 0===s?void 0:s.geometryType,sumOfLength:!1,sumOfArea:!1,summaryFieldsList:[],intersectedSummaryFieldList:[],sumOfAreaLabel:this.nls("sumOfIntersectedArea"),sumOfLengthLabel:this.nls("sumOfIntersectedLength")},(()=>{this.updateItemValue()}))},this.onAddSummaryFieldsClick=e=>{e.stopPropagation(),this.setState({isAddNewSummaryField:!0,isNewFieldAdded:!0,summaryEditIndex:null},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()}))},this.editSummaryFields=(e,t,s)=>{e.stopPropagation(),this.setSidePopperAnchor(s),this.setState({isAddNewSummaryField:!0,isNewFieldAdded:!1,summaryEditField:t,summaryEditIndex:s},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()}))},this.setSidePopperAnchor=e=>{const t=this.summaryFieldsSidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:t})},this.deleteSummaryFields=(e,t)=>{var s,i;let a;e.stopPropagation();const l=this.state.summaryFieldsList.concat(this.state.intersectedSummaryFieldList);l.splice(t,1),0===l.length?null===(s=this.addSummaryFieldsRef.current)||void 0===s||s.focus():null===(i=this.summaryFieldsSidePopperTrigger.current)||void 0===i||i.focus(),this.state.analysisListSettings.forEach((e=>{const t=e.analysisInfo;e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===d.Summary&&(a={useDataSource:e.useDataSource,label:e.label,analysisInfo:{analysisId:e.analysisInfo.analysisId,analysisType:e.analysisInfo.analysisType,isSingleColorMode:t.isSingleColorMode,singleFieldColor:t.singleFieldColor,selectedColorStrip:t.selectedColorStrip,summaryFields:l,expandOnOpen:t.expandOnOpen,highlightResultsOnMap:t.highlightResultsOnMap,highlightColorOnMap:t.highlightColorOnMap}})})),this.updateItem(this.setEditIndex,a,this.props.editCurrentLayer.layerDsId,this.state.analysisType)},this.editExistingIntersectedSummaryField=(e,t,s,i)=>{let a;this.state.intersectedSummaryFieldList.forEach(((l,n)=>{a=this.updateSummaryIntersectedFields(e,t,s,i,l)})),this.state.summaryEditField.summaryFieldInfo.summaryBy===P.SumOfIntersectedArea?this.setState({sumOfAreaLabel:e}):this.state.summaryEditField.summaryFieldInfo.summaryBy===P.SumOfIntersectedLength&&this.setState({sumOfLengthLabel:e}),this.setState({intersectedSummaryFieldList:[...this.state.intersectedSummaryFieldList.slice(0,0),Object.assign({},this.state.intersectedSummaryFieldList[0],a),...this.state.intersectedSummaryFieldList.slice(1)]},(()=>{this.updateItemValue()}))},this.updateSummaryIntersectedFields=(e,t,s,i,a)=>{let l,n={};return"esriGeometryPolyline"===this.state.selectedLayerGeometry?l=P.SumOfIntersectedLength:"esriGeometryPolygon"===this.state.selectedLayerGeometry&&(l=P.SumOfIntersectedArea),n={fieldLabel:e,fieldColor:a.fieldColor,summaryFieldInfo:{summaryBy:l,showSeparator:t,numberFormattingOption:s,significantDigits:i}},n},this.onOkButtonClick=(e,t,s,i)=>{this.editExistingIntersectedSummaryField(e,t,s,i)},this.createFieldsOptionElement=(t,s)=>(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{tabIndex:0,"aria-label":t.fieldLabel,className:"text-truncate labelAlign",title:t.fieldLabel},t.fieldLabel),(0,e.jsx)(i.Button,{role:"button","aria-label":t.fieldLabel+this.nls("editExpression"),className:"ml-1",title:this.nls("editExpression"),icon:!0,type:"tertiary",size:"sm",onClick:e=>{this.editSummaryFields(e,t,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.editSummaryFields(e,t,s)}},(0,e.jsx)(X,{size:"s"})),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("deleteOption"),title:this.nls("deleteOption"),icon:!0,type:"tertiary",size:"sm",onClick:e=>{this.deleteSummaryFields(e,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.deleteSummaryFields(e,s)}},(0,e.jsx)(H,{size:"s"}))),this.onEditPopperClose=()=>{this.setState({editSummaryAreaLengthFieldPopupOpen:!1})},this.updateSortedSummaryFields=e=>{this.setState({summaryFieldsList:e},(()=>{this.updateItemValue()}))},this.onColorSettingClick=()=>{this.openColorSetting(!0)},this.closeColorSettingsPanel=()=>{this.openColorSetting(!1),this.focusColorSetting()},this.focusColorSetting=()=>{setTimeout((()=>{var e;null===(e=this.colorButtonRef.current)||void 0===e||e.focus()}),50)},this.openColorSetting=e=>{this.setState({showSummaryColorSettings:e},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus(),setTimeout((()=>{var e;null===(e=this.colorSidePopperTrigger.current)||void 0===e||e.focus()}),50)}))},this.onUpdateFieldColorByCategory=(e,t,s)=>{var i,a;const l=null===(i=this.state.summaryFieldsList)||void 0===i?void 0:i.map(((i,a)=>{var l,n;return Object.assign(Object.assign({},i),{fieldColor:(null===(l=null==e?void 0:e[i.fieldLabel+"_"+a])||void 0===l?void 0:l._fillColor)?null===(n=null==e?void 0:e[i.fieldLabel+"_"+a])||void 0===n?void 0:n._fillColor:s?this.state.colorstripValues[a%this.state.colorstripValues.length]:null==t?void 0:t[a%(null==t?void 0:t.length)]})})),n=null===(a=this.state.intersectedSummaryFieldList)||void 0===a?void 0:a.map(((i,a)=>{var l,n;return Object.assign(Object.assign({},i),{fieldColor:(null===(l=null==e?void 0:e[i.fieldLabel+"_"+this.state.summaryFieldsList.length])||void 0===l?void 0:l._fillColor)?null===(n=null==e?void 0:e[i.fieldLabel+"_"+this.state.summaryFieldsList.length])||void 0===n?void 0:n._fillColor:s?this.state.colorstripValues[a%this.state.colorstripValues.length]:null==t?void 0:t[a%(null==t?void 0:t.length)]})}));this.setState({summaryFieldsList:l,intersectedSummaryFieldList:n,byCategoryColorFields:e,colorstripValues:t},(()=>{this.updateItemValue()}))},this.handleColorTypeChange=e=>{e===V.SingleColor?this.updateFieldColorBySingleColor(this.state.singleColorFields):e===V.ByCategory&&this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues,!0),this.setState({singleColorMode:e===V.SingleColor},(()=>{this.updateItemValue()}))},this.handleSingleColorChange=e=>{this.setState({singleColorFields:e},(()=>{this.updateFieldColorBySingleColor(this.state.singleColorFields)}))},this.updateFieldColorBySingleColor=e=>{var t,s;const i=null===(t=this.state.summaryFieldsList)||void 0===t?void 0:t.map(((t,s)=>Object.assign(Object.assign({},t),{fieldColor:e}))),a=null===(s=this.state.intersectedSummaryFieldList)||void 0===s?void 0:s.map(((t,s)=>Object.assign(Object.assign({},t),{fieldColor:e})));this.setState({summaryFieldsList:i,intersectedSummaryFieldList:a},(()=>{this.updateItemValue()}))},this.handleByCategorySettingColorChange=()=>{this.openColorSetting(!0)},this.handleSortOrderKeyUp=t=>{"Enter"!==t.key&&" "!==t.key||this.setState({sortFeaturesFieldOrder:this.state.sortFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))},this.handleGroupOrderKeyUp=t=>{"Enter"!==t.key&&" "!==t.key||this.setState({groupFeaturesFieldOrder:this.state.groupFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))},this.getFieldsDs=e=>{var t;const s=[],i=u(e);s.push({layerDsId:e}),this.setState({selectedFieldsDataSource:s,selectedLayerGeometry:null===(t=null==i?void 0:i.layerDefinition)||void 0===t?void 0:t.geometryType})},this.createDisplayFieldOption=t=>{const s=u(t.layerDsId);return(0,e.jsx)(he.FieldSelector,{dataSources:s?[s]:[],isSearchInputHidden:!0,onChange:this.onDisplayField.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.displayField),isMultiple:!1})},this.createSortFieldSelectorOption=(t,s)=>{const a=u(t.layerDsId);return(0,e.jsx)("div",{className:"sort-field-section p-1"},(0,e.jsx)("div",{className:"sort-field-selector"},(0,e.jsx)(he.FieldSelector,{dataSources:a?[a]:[],isSearchInputHidden:!0,onChange:this.onSortFieldSelectChange.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.sortFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})),(0,e.jsx)("div",{className:"sort-icon"},(0,e.jsx)(i.Button,{size:"sm",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.sortFeaturesFieldOrder===e.OrderRule.Asc?this.nls("ascending"):this.nls("decending"),onKeyUp:e=>{this.handleSortOrderKeyUp(e)},onClick:()=>{this.setState({sortFeaturesFieldOrder:this.state.sortFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))}},this.state.sortFeaturesFieldOrder===e.OrderRule.Desc&&(0,e.jsx)(ge,{size:"s",className:"sort-arrow-down-icon ml-0"}),this.state.sortFeaturesFieldOrder===e.OrderRule.Asc&&(0,e.jsx)(ue,{size:"s",className:"sort-arrow-down-icon ml-0"}))))},this.createGroupFieldSelectorOption=(t,s)=>{const a=u(t.layerDsId);return(0,e.jsx)("div",{className:"sort-field-section p-1"},(0,e.jsx)("div",{className:"sort-field-selector"},(0,e.jsx)(he.FieldSelector,{dataSources:a?[a]:[],isSearchInputHidden:!0,onChange:this.onGroupFieldSelectChange.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.groupFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})),(0,e.jsx)("div",{className:"sort-icon"},(0,e.jsx)(i.Button,{size:"sm",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.groupFeaturesFieldOrder===e.OrderRule.Asc?this.nls("ascending"):this.nls("decending"),onKeyUp:e=>{this.handleGroupOrderKeyUp(e)},onClick:()=>{this.setState({groupFeaturesFieldOrder:this.state.groupFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))}},this.state.groupFeaturesFieldOrder===e.OrderRule.Desc&&(0,e.jsx)(ge,{size:"s",className:"sort-arrow-down-icon ml-0"}),this.state.groupFeaturesFieldOrder===e.OrderRule.Asc&&(0,e.jsx)(ue,{size:"s",className:"sort-arrow-down-icon ml-0"}))))},this.groupFeaturesOnChange=e=>{this.setState({isGroupFeatures:e.target.checked},(()=>{this.updateItemValue()}))},this.sortGroupsByCountOnChange=e=>{this.setState({isSortGroupsByCount:e.target.checked},(()=>{this.updateItemValue()}))},this.onSumOfAreaChange=(e,t)=>{this.updateIntersectedFields(e.target.checked,t),this.setState({sumOfArea:e.target.checked})},this.onSumOfLengthChange=(e,t)=>{this.updateIntersectedFields(e.target.checked,t),this.setState({sumOfLength:e.target.checked})},this.updateIntersectedFields=(e,t)=>{if(e){const e={fieldLabel:t===P.SumOfIntersectedLength?this.state.sumOfLengthLabel:this.state.sumOfAreaLabel,fieldColor:this.state.singleColorMode?this.state.singleColorFields:N,summaryFieldInfo:{summaryBy:t,showSeparator:!0,numberFormattingOption:E.NoFormatting,significantDigits:0}};this.setState({intersectedSummaryFieldList:[...this.state.intersectedSummaryFieldList.slice(0,0),Object.assign({},this.state.intersectedSummaryFieldList[0],e),...this.state.intersectedSummaryFieldList.slice(1)]},(()=>{this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues)}))}else this.state.intersectedSummaryFieldList.splice(0,1),this.updateItemValue()},this.onSumOfAreaEditClick=e=>{this.onIntersectedFieldEdit(e)},this.onSumOfLengthEditClick=e=>{this.onIntersectedFieldEdit(e)},this.onIntersectedFieldEdit=e=>{this.setState({editSummaryAreaLengthFieldPopupOpen:!0,sumOfIntersectedFieldPopupTitle:e===P.SumOfIntersectedArea?this.nls("editSumOfIntersectedArea"):this.nls("editSumOfIntersectedLength")}),this.state.intersectedSummaryFieldList.forEach((t=>{t.summaryFieldInfo.summaryBy===e&&this.setState({summaryEditField:t})}))},this.closeAddSummaryFieldPanel=()=>{this.setState({isAddNewSummaryField:!1},(()=>{this.addSummaryFieldsRef.current.focus()}))},this.onExpressionInfoUpdate=e=>{this.setState({isAddNewSummaryField:!1});const t={fieldLabel:e.fieldLabel,fieldColor:this.state.singleColorMode?this.state.singleColorFields:N,summaryFieldInfo:e.selectedExpression};this.state.isNewFieldAdded?this.setState({summaryFieldsList:[...this.state.summaryFieldsList,t],expressionInfo:e.selectedExpression},(()=>{this.setSidePopperAnchor(this.state.summaryFieldsList.length-1),this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues)})):this.setState({expressionInfo:e.selectedExpression},(()=>{this.updateExistingField(t)}))},this.updateExistingField=e=>{const t=this.state.summaryEditIndex;t>-1&&this.setState({summaryFieldsList:[...this.state.summaryFieldsList.slice(0,t),Object.assign({},this.state.summaryFieldsList[t],e),...this.state.summaryFieldsList.slice(t+1)]},(()=>{this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues)}))},this.getDsRootIdsByWidgetId=()=>{var t,s;const i=[],a=(null===(s=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===s?void 0:s.appConfig).dataSources[this.props.activeDs];return(null==a?void 0:a.type)!==e.ArcGISDataSourceTypes.WebMap&&(null==a?void 0:a.type)!==e.ArcGISDataSourceTypes.WebScene||i.push(this.props.activeDs),i.length>0?(0,e.Immutable)(i):void 0},this.dataSourceChangeSave=e=>{var t;if(!e)return;const s=null===(t=this.props)||void 0===t?void 0:t.availableFeatureLayer.find((t=>t.id===e[0].dataSourceId));this.resetAnalysisValues(e[0]),this.setState({layerLabel:(null==s?void 0:s.getLabel())?s.getLabel():"",useDataSource:e[0]},(()=>{this.updateItemValue(!0,this.state.layerLabel,this.state.useDataSource)}))},this.expandFeatureOnChange=e=>{this.setState({expandFeatureDetails:e.target.checked},(()=>{this.updateItemValue()}))},this.highlightResultsOnMapOnChange=e=>{this.setState({highlightResultsOnMap:e.target.checked},(()=>{this.updateItemValue()}))},this.onHighlightColorOnMapChange=e=>{this.setState({highlightColorOnMap:e},(()=>{this.updateItemValue()}))},this.state={closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!1,analysisListSettings:this.props.analysisList||[],selectedLayers:[],useDataSource:null,layerLabel:"",analysisType:"",displayField:[],sortFeaturesByDistance:!0,sortFeaturesField:[],sortFeaturesFieldOrder:e.OrderRule.Asc,selectedFieldsDataSource:[],isGroupFeatures:!1,groupFeaturesField:[],groupFeaturesFieldOrder:e.OrderRule.Asc,isSortGroupsByCount:!1,expandOnOpen:!1,editSummaryAreaLengthFieldPopupOpen:!1,sumOfArea:!1,sumOfLength:!1,sumOfAreaLabel:this.nls("sumOfIntersectedArea"),sumOfLengthLabel:this.nls("sumOfIntersectedLength"),selectedLayerGeometry:this.props.selectedLayerGeometry,summaryFieldsList:[],intersectedSummaryFieldList:[],summaryEditIndex:null,summaryEditField:null,expressionInfo:null,sumOfIntersectedFieldPopupTitle:"",isAddNewSummaryField:!1,isNewFieldAdded:!1,showSummaryColorSettings:!1,singleColorFields:N,byCategoryColorFields:null,singleColorMode:!0,colorstripValues:U,popperFocusNode:null,expandFeatureDetails:!1,highlightResultsOnMap:!0,highlightColorOnMap:k},this.setEditIndex=0,this.defaultSelectedItem.name=this.nls("noSelectionItemLabel"),this.updateSummaryFieldListSettings=[]}render(){var s,a,l,r,h,p;const c=e.DataSourceManager.getInstance().getDataSource(this.props.activeDs).getChildDataSources();let u=!1;const m=[];c&&c.forEach((t=>{var s;"Table"!==(null===(s=null==t?void 0:t.layerDefinition)||void 0===s?void 0:s.type)&&((null==t?void 0:t.type)===e.DataSourceTypes.MapService||(null==t?void 0:t.type)===e.DataSourceTypes.GroupLayer?t.getChildDataSources().forEach((e=>{m.push(e.id)})):m.length>0?(m.find((e=>e.id===t.id))||(u=!0),u&&m.push(t.id)):m.push(t.id))}));const y={fromRootDsIds:this.getDsRootIdsByWidgetId(),fromDsIds:(0,e.Immutable)(m)};return(0,e.jsx)("div",{css:n(this.props.theme,this.props.isActiveMapAreaSelected),style:{height:"calc(100% - 112px)",width:"100%",overflow:"auto"}},(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,{label:this.nls("selectLayer"),flow:"wrap"},(0,e.jsx)(he.DataSourceSelector,{types:this.supportedDsTypes,useDataSources:this.state.useDataSource?(0,e.Immutable)([this.state.useDataSource]):(0,e.Immutable)([]),fromRootDsIds:y.fromRootDsIds,fromDsIds:y.fromDsIds,mustUseDataSource:!0,onChange:this.dataSourceChangeSave,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideAddDataButton:!0,disableRemove:()=>!0,hideDataView:!0,useDataSourcesEnabled:!0})),(0,e.jsx)(t.SettingRow,{label:this.nls("label"),flow:"wrap"},(0,e.jsx)(i.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("label")+this.state.layerLabel,title:this.state.layerLabel,size:"sm",value:this.state.layerLabel,onAcceptValue:this.onLayerLabelAcceptValue,onChange:this.onLayerLabelChange}))),(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-1"},this.nls("analysisTypeLabel")))),(0,e.jsx)(t.SettingRow,{className:"mt-3",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0 analysisTypeWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls(d.Closest),className:"cursor-pointer",value:this.nls(d.Closest),onChange:()=>{this.onAnalysisTypeChange(d.Closest)},checked:this.state.analysisType===d.Closest,disabled:this.props.isActiveMapAreaSelected}),(0,e.jsx)("div",{tabIndex:0,className:(0,e.classNames)("ml-1 text-break",this.props.isActiveMapAreaSelected?"disabled-label":"cursor-pointer"),onClick:()=>{!this.props.isActiveMapAreaSelected&&this.state.analysisType!==d.Closest&&this.onAnalysisTypeChange(d.Closest)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!this.props.isActiveMapAreaSelected&&this.state.analysisType!==d.Closest&&this.onAnalysisTypeChange(d.Closest)}},this.nls(d.Closest))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("closestAnalysisTypeTooltip"),title:this.nls("closestAnalysisTypeTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(w,null)))),this.props.isActiveMapAreaSelected&&this.state.analysisType===d.Closest&&(0,e.jsx)(i.Alert,{tabIndex:0,withIcon:!0,size:"small",type:"warning",className:"w-100 shadow mb-2 mt-2"},(0,e.jsx)("div",{className:"flex-grow-1 text-break settings-text-level"},this.nls("warningMsgIfActiveMapArea"))),(0,e.jsx)(t.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0 analysisTypeWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls(d.Proximity),className:"cursor-pointer",value:this.nls(d.Proximity),onChange:()=>{this.onAnalysisTypeChange(d.Proximity)},checked:this.state.analysisType===d.Proximity}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{this.state.analysisType!==d.Proximity&&this.onAnalysisTypeChange(d.Proximity)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.state.analysisType!==d.Proximity&&this.onAnalysisTypeChange(d.Proximity)}},this.nls(d.Proximity))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("proximityAnalysisTypeTooltip"),title:this.nls("proximityAnalysisTypeTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(w,null)))),(0,e.jsx)(t.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0 analysisTypeWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls(d.Summary),className:"cursor-pointer",value:this.nls(d.Summary),onChange:()=>{this.onAnalysisTypeChange(d.Summary)},checked:this.state.analysisType===d.Summary}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{this.state.analysisType!==d.Summary&&this.onAnalysisTypeChange(d.Summary)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.state.analysisType!==d.Summary&&this.onAnalysisTypeChange(d.Summary)}},this.nls(d.Summary))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("summaryAnalysisTypeTooltip"),title:this.nls("summaryAnalysisTypeTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(w,null)))),this.state.proximityAnalysisType&&this.state.analysisType===d.Proximity&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{label:this.nls("displayFieldLabel"),flow:"wrap"},this.createDisplayFieldOption(this.state.selectedFieldsDataSource[0])),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("sortFeaturesLabel"),title:this.nls("sortFeaturesLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("sortFeaturesLabel")))),(0,e.jsx)(t.SettingRow,{className:"mt-1 ml-3",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("distanceLabel"),className:"cursor-pointer",value:"distanceLabel",onChange:()=>{this.handleSortFeaturesOptionsChange(!0)},checked:this.state.sortFeaturesByDistance}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleSortFeaturesOptionsChange(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSortFeaturesOptionsChange(!0)}},this.nls("distanceLabel")))),(0,e.jsx)(t.SettingRow,{className:"mt-2 ml-3",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("field"),className:"cursor-pointer",value:"field",onChange:()=>{this.handleSortFeaturesOptionsChange(!1)},checked:!this.state.sortFeaturesByDistance}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleSortFeaturesOptionsChange(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSortFeaturesOptionsChange(!1)}},this.nls("field")))),!this.state.sortFeaturesByDistance&&(0,e.jsx)(J.List,{className:"pt-3 pb-3",size:"sm",itemsJson:null===(s=Array.from(this.state.selectedFieldsDataSource))||void 0===s?void 0:s.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:J.TreeItemActionType.RenderOverrideItem,children:[{name:J.TreeItemActionType.RenderOverrideItemBody,children:[{name:J.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createSortFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsx)(t.SettingRow,{label:this.nls("groupFeaturesLabel")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("groupFeaturesLabel"),title:this.nls("groupFeaturesLabel"),checked:this.state.isGroupFeatures,onChange:this.groupFeaturesOnChange})),this.state.isGroupFeatures&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(J.List,{className:"pt-3 pb-3",size:"sm",itemsJson:null===(a=Array.from(this.state.selectedFieldsDataSource))||void 0===a?void 0:a.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:J.TreeItemActionType.RenderOverrideItem,children:[{name:J.TreeItemActionType.RenderOverrideItemBody,children:[{name:J.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createGroupFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsx)(t.SettingRow,{label:this.nls("sortGroupsByCount")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("sortGroupsByCount"),title:this.nls("sortGroupsByCount"),checked:this.state.isSortGroupsByCount,onChange:this.sortGroupsByCountOnChange})))),this.state.summaryAnalysisType&&this.state.analysisType===d.Summary&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{tabIndex:-1,className:"pt-2 pb-1"},(0,e.jsx)("div",{ref:this.addSummaryFieldsRef,tabIndex:0,"aria-label":this.nls("addSummaryFields"),title:this.nls("addSummaryFields"),className:"d-flex align-items-center add-summary-field",onClick:e=>{this.onAddSummaryFieldsClick(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onAddSummaryFieldsClick(e)}},(0,e.jsx)("div",{tabIndex:-1,className:"add-summary-field-icon-container d-flex align-items-center justify-content-center mr-2"},(0,e.jsx)(i.Icon,{tabIndex:-1,icon:be,size:12})),(0,e.jsx)("div",{tabIndex:-1,className:"pt-1 text-truncate flex-grow-1"},this.nls("addSummaryFields"))),0===this.state.summaryFieldsList.length&&(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("addSummaryHintMsg"),className:"font-italic w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("addSummaryHintMsg")))),this.state.summaryFieldsList.length>0&&(0,e.jsx)("div",{ref:this.summaryFieldsSidePopperTrigger,className:(0,e.classNames)("nearme-summary-fields-list-items","esriGeometryPoint"===this.state.selectedLayerGeometry?"pb-2":"")},(0,e.jsx)(J.List,{itemsJson:null===(l=Array.from(this.state.summaryFieldsList||null))||void 0===l?void 0:l.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s,a=i.map((e=>e.itemStateDetailContent));this.updateSortedSummaryFields(a)},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:J.TreeItemActionType.RenderOverrideItem,children:[{name:J.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:J.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:J.TreeItemActionType.RenderOverrideItemBody,children:[{name:J.TreeItemActionType.RenderOverrideItemDragHandle},{name:J.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createFieldsOptionElement(i.itemStateDetailContent,a.indexOf(i))}})),("esriGeometryPolyline"===this.state.selectedLayerGeometry||"esriGeometryPolygon"===this.state.selectedLayerGeometry)&&(0,e.jsx)(t.SettingRow,{label:"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfIntersectedLength"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfIntersectedArea"):""},(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfLengthTooltip"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfAreaTooltip"):"",title:"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfLengthTooltip"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfAreaTooltip"):"",showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 ml-2 d-inline"},(0,e.jsx)(w,null)))),"esriGeometryPolyline"===this.state.selectedLayerGeometry&&(0,e.jsx)("div",{className:(0,e.classNames)("pb-2 d-flex align-items-center justify-content-between")},(0,e.jsx)(i.Label,{title:this.state.sumOfLengthLabel,className:"pt-2 pl-1 text-truncate cursor-pointer"},(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.state.sumOfLength,role:"checkbox","aria-label":this.nls("sumOfIntersectedLength"),onChange:e=>{this.onSumOfLengthChange(e,P.SumOfIntersectedLength)}}),this.state.sumOfLengthLabel),this.state.sumOfLength&&(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("edit"),title:this.nls("edit"),icon:!0,type:"tertiary","aria-haspopup":"dialog",size:"sm",onClick:()=>{this.onSumOfLengthEditClick(P.SumOfIntersectedLength)}},(0,e.jsx)(X,{size:"s"}))),"esriGeometryPolygon"===this.state.selectedLayerGeometry&&(0,e.jsx)("div",{className:(0,e.classNames)("pb-2 d-flex align-items-center justify-content-between")},(0,e.jsx)(i.Label,{title:this.state.sumOfAreaLabel,className:"pt-2 pl-1 text-truncate cursor-pointer"},(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.state.sumOfArea,role:"checkbox","aria-label":this.nls("sumOfIntersectedArea"),onChange:e=>{this.onSumOfAreaChange(e,P.SumOfIntersectedArea)}}),this.state.sumOfAreaLabel),this.state.sumOfArea&&(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("edit"),title:this.nls("edit"),icon:!0,type:"tertiary","aria-haspopup":"dialog",size:"sm",onClick:()=>{this.onSumOfAreaEditClick(P.SumOfIntersectedArea)}},(0,e.jsx)(X,{size:"s"}))),(null===(r=this.updateSummaryFieldListSettings)||void 0===r?void 0:r.length)>0&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{className:(0,e.classNames)("pt-3",this.state.summaryFieldsList.length>0||this.state.sumOfArea||this.state.sumOfLength?"pt-2 nearme-divider":""),label:this.nls("themeSettingColorMode"),flow:"wrap"}),(0,e.jsx)(t.SettingRow,{className:"mt-0",flow:"wrap"},(0,e.jsx)(i.Label,{className:"mt-1 colorModesWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("singleColor"),className:"cursor-pointer",value:"singleColor",onChange:()=>{this.handleColorTypeChange(V.SingleColor)},checked:this.state.singleColorMode}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleColorTypeChange(V.SingleColor)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleColorTypeChange(V.SingleColor)}},this.nls("singleColor"))),this.state.singleColorMode&&(0,e.jsx)(C.ThemeColorPicker,{specificTheme:(0,L.getTheme2)(),value:this.state.singleColorFields,onChange:e=>{this.handleSingleColorChange(e)}})),(0,e.jsx)(t.SettingRow,{className:"mt-0",flow:"wrap"},(0,e.jsx)(i.Label,{className:"mt-1 mb-1 colorModesWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("byCategory"),className:"cursor-pointer",value:"byCategory",onChange:()=>{this.handleColorTypeChange(V.ByCategory)},checked:!this.state.singleColorMode}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleColorTypeChange(V.ByCategory)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleColorTypeChange(V.ByCategory)}},this.nls("byCategory"))),!this.state.singleColorMode&&(0,e.jsx)(i.Button,{ref:this.colorButtonRef,role:"button","aria-label":this.nls("byCategory"),title:this.nls("byCategory"),icon:!0,type:"tertiary",size:"sm",onClick:this.handleByCategorySettingColorChange.bind(this)},(0,e.jsx)(se,null)))),(0,e.jsx)(t.SidePopper,{isOpen:this.state.isAddNewSummaryField&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeAddSummaryFieldPanel,trigger:null===(h=this.summaryFieldsSidePopperTrigger)||void 0===h?void 0:h.current,backToFocusNode:this.state.popperFocusNode},(0,e.jsx)("div",{className:"bg-light-300 border-color-gray-400",css:o(this.props.theme)},(0,e.jsx)(ne,{theme:this.props.theme,intl:this.props.intl,title:null!==this.state.summaryEditIndex?this.nls("editSummaryField"):this.nls("addSummaryFields"),ref:this.backRef,onBack:this.closeAddSummaryFieldPanel},(0,e.jsx)(Se,{intl:this.props.intl,theme:this.props.theme,widgetId:this.props.widgetId,currentLayerDsId:this.props.editCurrentLayer,fieldsEditIndex:this.state.summaryEditIndex,editingField:this.state.summaryEditField,expressionInfoUpdate:this.onExpressionInfoUpdate.bind(this)})))),(0,e.jsx)(t.SidePopper,{isOpen:this.state.showSummaryColorSettings&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeColorSettingsPanel,trigger:null===(p=this.colorSidePopperTrigger)||void 0===p?void 0:p.current},(0,e.jsx)("div",{className:"bg-light-300 border-color-gray-400",css:o(this.props.theme)},(0,e.jsx)(ne,{theme:this.props.theme,intl:this.props.intl,title:this.nls("summaryFieldColor"),ref:this.backRef,onBack:this.closeColorSettingsPanel},(0,e.jsx)("div",{className:"setting-container"},(0,e.jsx)(de,{intl:this.props.intl,theme:this.props.theme,summaryFieldsInfo:this.updateSummaryFieldListSettings,colorstripValue:this.state.colorstripValues,updateFieldColorsValues:this.onUpdateFieldColorByCategory}))))),this.state.editSummaryAreaLengthFieldPopupOpen&&(0,e.jsx)(xe,{theme:this.props.theme,intl:this.props.intl,isOpen:this.state.editSummaryAreaLengthFieldPopupOpen,editSummaryFields:this.state.summaryEditField,sumOfIntersectedFieldPopupTitle:this.state.sumOfIntersectedFieldPopupTitle,onClose:this.onEditPopperClose,onOkClick:this.onOkButtonClick})),!this.props.isActiveMapAreaSelected&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{label:this.nls("highlightResultsOnMapLabel")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("highlightResultsOnMapLabel"),title:this.nls("highlightResultsOnMapLabel"),checked:this.state.highlightResultsOnMap,onChange:this.highlightResultsOnMapOnChange})),this.state.highlightResultsOnMap&&(0,e.jsx)(t.SettingRow,{label:this.nls("highlightColorLabel")},(0,e.jsx)(C.ThemeColorPicker,{specificTheme:(0,L.getTheme2)(),value:this.state.highlightColorOnMap?this.state.highlightColorOnMap:k,onChange:e=>{this.onHighlightColorOnMapChange(e)}}))),(0,e.jsx)(t.SettingRow,{label:this.nls("expandOnOpen")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("expandOnOpen"),title:this.nls("expandOnOpen"),checked:this.state.expandOnOpen,onChange:this.expandListOnChange})),this.state.proximityAnalysisType&&this.state.expandOnOpen&&(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{title:this.nls("expandFeatureDetails"),className:"m-0 w-100",centric:!0},(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.state.expandFeatureDetails,role:"checkbox","aria-label":this.nls("expandFeatureDetails"),onChange:e=>{this.expandFeatureOnChange(e)}}),(0,e.jsx)("div",{className:"ml-1 w-100 text-break",onClick:e=>{"span"!==e.target.tagName.toLowerCase()&&e.preventDefault()}},(0,e.jsx)("span",{className:"cursor-pointer"},this.nls("expandFeatureDetails"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("expandListTooltip"),title:this.nls("expandListTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline",onClick:e=>{e.preventDefault()}},(0,e.jsx)(w,null)))))))}}let Ie=[];class Fe extends e.React.PureComponent{constructor(t){var s,i,n,o,r,h;super(t),this.analysisLayersPopperTrigger=e.React.createRef(),this.backRef=e.React.createRef(),this.mvManager=a.MapViewManager.getInstance(),this.allDsLayers=[],this.nls=t=>{const s=Object.assign({},l,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.componentDidMount=()=>{var e,t;Ie=this.collectionOfLayerInfos();const s=[];(null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo.length)>0&&(null===(t=this.props.activeDsLayersConfig)||void 0===t||t.layersInfo.map((e=>(s.push(e),!0))),this.setState({newAddedLayerAnalysis:s}))},this.componentDidUpdate=e=>{e.activeDsSearchConfig.searchByActiveMapArea!==this.props.activeDsSearchConfig.searchByActiveMapArea&&(Ie=this.collectionOfLayerInfos())},this.displayFeatureCountStateChange=e=>{this.setState({displayFeatureCount:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("displayFeatureCount",this.state.displayFeatureCount)}))},this.displayAnalysisIconStateChange=e=>{this.setState({displayAnalysisIcon:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("displayAnalysisIcon",this.state.displayAnalysisIcon)}))},this.collectionOfLayerInfos=()=>{const e=[];this.props.allFeatureLayers.forEach(((e,t)=>{e.value===this.props.selectedDs&&e.availableLayers.forEach((e=>{const t=u(e.layerDsId);this.allDsLayers.push(t)}))}));for(let t=0;t<this.allDsLayers.length;t++)for(let s=0;s<M.length;s++)this.props.activeDsSearchConfig.searchByActiveMapArea&&M[s]===d.Closest||e.push({analysisType:M[s],featureLayer:this.allDsLayers[t]});return e},this.onAddAnalysisClick=()=>{var e,t,s,i,a,l;if((null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo.length)>0){const e=[];for(let t=0;t<Ie.length;t++)for(let s=0;s<this.state.newAddedLayerAnalysis.length;s++)Ie[t].analysisType===this.state.newAddedLayerAnalysis[s].analysisInfo.analysisType&&Ie[t].featureLayer.id===this.state.newAddedLayerAnalysis[s].useDataSource.dataSourceId&&e.push(t);const n=[];Ie.forEach(((t,s)=>{e.includes(s)||n.push(s)}));const o={dataSourceId:null===(s=null===(t=Ie[null==n?void 0:n[0]])||void 0===t?void 0:t.featureLayer)||void 0===s?void 0:s.id,mainDataSourceId:null===(a=null===(i=Ie[null==n?void 0:n[0]])||void 0===i?void 0:i.featureLayer)||void 0===a?void 0:a.id,rootDataSourceId:this.props.selectedDs};if(n.length>0){const e=R.find((e=>e.analysisType===Ie[n[0]].analysisType)),t=u(Ie[n[0]].featureLayer.id),s={useDataSource:o,label:t.getLabel(),analysisInfo:e},i=s.analysisInfo;i.analysisId=v(),Ie[n[0]].analysisType===d.Proximity&&(i.displayField=x(t.layerDefinition)),s.analysisInfo=i,this.setState({newAddedLayerAnalysis:[...this.state.newAddedLayerAnalysis,s],analysisIndex:this.state.newAddedLayerAnalysis.length,editCurrentLayer:{layerDsId:Ie[n[0]].featureLayer.id,analysisType:Ie[n[0]].analysisType},selectedLayerGeometryType:null===(l=t.layerDefinition)||void 0===l?void 0:l.geometryType}),this.setState({showEditAnalysisPopper:!0})}else this.displayDefaultClosestOrProximity(Ie,!0)}else this.displayDefaultClosestOrProximity(Ie,!1)},this.displayDefaultClosestOrProximity=(e,t)=>{const s={useDataSource:{dataSourceId:e[0].featureLayer.id,mainDataSourceId:e[0].featureLayer.id,rootDataSourceId:this.props.selectedDs},label:u(e[0].featureLayer.id).getLabel(),analysisInfo:this.props.activeDsSearchConfig.searchByActiveMapArea?R[1]:R[0]},i=s.analysisInfo;i.analysisId=v(),s.analysisInfo=i,this.setState({newAddedLayerAnalysis:t?[...this.state.newAddedLayerAnalysis,s]:[s],analysisIndex:this.state.newAddedLayerAnalysis.length,editCurrentLayer:{layerDsId:e[0].featureLayer.id,analysisType:e[0].analysisType},showEditAnalysisPopper:!0})},this.closeEditAnalysisPopper=()=>{var e,t,s;this.setSidePopperAnchor(this.state.analysisIndex),this.setState({newAddedLayerAnalysis:(null===(t=null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo)||void 0===t?void 0:t.length)>0?null===(s=this.props.activeDsLayersConfig)||void 0===s?void 0:s.layersInfo:[],showEditAnalysisPopper:!1,analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""}},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis)}))},this.editOkButtonCLick=()=>{this.setState({showEditAnalysisPopper:!1,newAddedLayerAnalysis:this.isAnalysisEdited?this.state.updatedAddedLayerAnalysis:this.state.newAddedLayerAnalysis},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis);let e=[];this.state.newAddedLayerAnalysis.forEach((t=>{e=Object.assign(e,this.useDataSources),e.push(t.useDataSource)})),this.useDataSources=e,setTimeout((()=>{this.props.getAddedLayersInfoUseDs(this.useDataSources)}),100)})),this.isAnalysisEdited=!1},this.onEditButtonClick=(e,t,s,i)=>{this.setSidePopperAnchor(i),this.setState({showEditAnalysisPopper:e,analysisIndex:i,editCurrentLayer:{layerDsId:t,analysisType:s}})},this.setSidePopperAnchor=e=>{var t;const s=null===(t=this.analysisLayersPopperTrigger.current)||void 0===t?void 0:t.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:s})},this.onDeleteButtonClick=(e,t,s,i)=>{this.setState({newAddedLayerAnalysis:e,analysisIndex:i},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",e),setTimeout((()=>{this.props.getAddedLayersInfoUseDs(this.useDataSources)}),100),-1===this.state.analysisIndex&&this.state.editCurrentLayer.layerDsId===t&&this.state.editCurrentLayer.analysisType===s&&(this.setSidePopperAnchor(this.state.analysisIndex),this.setState({showEditAnalysisPopper:!1,analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""}},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis)})))}))},this.updateLayersInfoSettings=(e,t,s,i)=>{this.setState({newAddedLayerAnalysis:e,analysisIndex:t,editCurrentLayer:{layerDsId:s,analysisType:i}},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",e)}))},this.onAnalysisInfoUpdate=(e,t,s,i)=>{this.isAnalysisEdited=!0,this.setState({updatedAddedLayerAnalysis:e,analysisIndex:i,editCurrentLayer:{layerDsId:t,analysisType:s}})},this.onDisableOkButton=e=>{this.setState({disableSidePopperOkButton:e})},this.props.activeDsLayersConfig&&(this.state={showEditAnalysisPopper:!1,newAddedLayerAnalysis:(null===(i=null===(s=this.props.activeDsLayersConfig)||void 0===s?void 0:s.layersInfo)||void 0===i?void 0:i.length)>0?null===(n=this.props.activeDsLayersConfig)||void 0===n?void 0:n.layersInfo:[],updatedAddedLayerAnalysis:(null===(r=null===(o=this.props.activeDsLayersConfig)||void 0===o?void 0:o.layersInfo)||void 0===r?void 0:r.length)>0?null===(h=this.props.activeDsLayersConfig)||void 0===h?void 0:h.layersInfo:[],displayFeatureCount:this.props.activeDsLayersConfig.displayFeatureCount,displayAnalysisIcon:this.props.activeDsLayersConfig.displayAnalysisIcon,layersAnalysisType:"",analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""},selectedLayerGeometryType:"",popperFocusNode:null,disableSidePopperOkButton:!1}),this.useDataSources=this.props.useDataSourceConfig,this.isAnalysisEdited=!1}render(){var s;return(0,e.jsx)("div",{css:n(this.props.theme,this.props.activeDsSearchConfig.searchByActiveMapArea),style:{height:"100%",width:"100%"}},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("configureLayerAnalysis"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("configureLayerAnalysis")+" "+this.nls("configureAnalysisTooltip"),title:this.nls("configureAnalysisTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(w,null)))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:this.onAddAnalysisClick.bind(this)},this.nls("addAnalysisLabel"))),this.state.newAddedLayerAnalysis&&this.state.newAddedLayerAnalysis.length>0&&(0,e.jsx)("div",{ref:this.analysisLayersPopperTrigger,tabIndex:-1,className:"w-100 mb-3 mt-2"},(0,e.jsx)(Y,{intl:this.props.intl,theme:this.props.theme,addedLayerAnalysis:this.state.newAddedLayerAnalysis,showEditAnalysisPopper:this.state.showEditAnalysisPopper,analysisIndex:this.state.analysisIndex,editCurrentLayer:this.state.editCurrentLayer,onEditAction:this.onEditButtonClick,onDeleteAction:this.onDeleteButtonClick.bind(this),onLayersInfoSettingsUpdated:this.updateLayersInfoSettings,isActiveMapAreaSelected:this.props.activeDsSearchConfig.searchByActiveMapArea})),(0,e.jsx)(t.SettingRow,{label:this.nls("displayFeatureCountLabel")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("displayFeatureCountLabel"),title:this.nls("displayFeatureCountLabel"),checked:this.state.displayFeatureCount,onChange:this.displayFeatureCountStateChange})),(0,e.jsx)(t.SettingRow,{label:this.nls("displayAnalysisIconLabel")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("displayAnalysisIconLabel"),title:this.nls("displayAnalysisIconLabel"),checked:this.state.displayAnalysisIcon,onChange:this.displayAnalysisIconStateChange})),(0,e.jsx)(t.SidePopper,{isOpen:this.state.showEditAnalysisPopper&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeEditAnalysisPopper.bind(this),trigger:null===(s=this.analysisLayersPopperTrigger)||void 0===s?void 0:s.current,backToFocusNode:this.state.popperFocusNode},(0,e.jsx)("div",{className:"bg-light-300 border-color-gray-400",css:o(this.props.theme)},(0,e.jsx)(ne,{theme:this.props.theme,intl:this.props.intl,title:this.nls("editAnalysis"),ref:this.backRef,hideBackArrow:!0,showCloseIcon:!0,disableOkButton:this.state.disableSidePopperOkButton,onBack:this.closeEditAnalysisPopper,showOkButton:!0,onOkButtonClicked:this.editOkButtonCLick},(0,e.jsx)(Ce,{widgetId:this.props.widgetId,intl:this.props.intl,theme:this.props.theme,isActiveMapAreaSelected:this.props.activeDsSearchConfig.searchByActiveMapArea,activeDs:this.props.selectedDs,analysisIndex:this.state.analysisIndex,availableFeatureLayer:this.allDsLayers,editCurrentLayer:this.state.editCurrentLayer,analysisList:this.state.newAddedLayerAnalysis,selectedLayerGeometry:this.state.selectedLayerGeometryType,onAnalysisUpdate:this.onAnalysisInfoUpdate,disableOkButton:this.onDisableOkButton})))))}}var we=function(e,t,s,i){return new(s||(s=Promise))((function(a,l){function n(e){try{r(i.next(e))}catch(e){l(e)}}function o(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}r((i=i.apply(e,t||[])).next())}))};class Le extends s.BaseWidgetSetting{constructor(t){super(t),this.mvManager=a.MapViewManager.getInstance(),this._mapLoadedTimer=null,this.nls=e=>{var t;const s=Object.assign({},l,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var t,s;let i;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const a=null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0];(null===(s=(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===s?void 0:s[a])?(i=!1,this.checkLayersAvailability(this.props.useMapWidgetIds)):(this.resetAnalysisLayersConfig(),i=!0)}else i=!0;this.updateConfigForMapWidget(i),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings","noResultsFoundText"],this.props.config.generalSettings.noResultsFoundText?this.props.config.generalSettings.noResultsFoundText:this.nls("noDataMessageDefaultText"))})}),50),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings","highlightColor"],this.props.config.generalSettings.highlightColor?this.props.config.generalSettings.highlightColor:this.props.theme2.colors.palette.primary[700])})}),50)},this.onMapWidgetSelected=t=>{let s;this.resetAnalysisLayersConfig(),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:t})}),100),t.length>0?(s=!1,this.checkLayersAvailability(t)):(s=!0,setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:(0,e.Immutable)([])},[])}),100)),this.updateConfigForMapWidget(s)},this.resetAnalysisLayersConfig=()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("configInfo",{})})},this.updateConfigForMapWidget=e=>{setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("useMapWidget",!e)})}),50),this.setState({mapWidgetExists:!e,isNoMapSelected:e})},this.setDefaultConfigForDataSource=t=>{if(!this.props.config.configInfo.hasOwnProperty(t)){const s=B;s.searchSettings.headingLabel=this.nls("locationLabel"),this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",t],s)});let i=[];i=Object.assign(i,this.props.useDataSources),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:(0,e.Immutable)(i)})}),100)}},this.waitForChildDataSourcesReady=t=>we(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const s=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==s?void 0:s.isDataSourceSet)&&!s.areChildDataSourcesCreated()?s.childDataSourcesReady().then((()=>s)).catch((e=>s)):Promise.resolve(s)})),this.checkLayersAvailability=t=>we(this,void 0,void 0,(function*(){const s=this.mvManager.getJimuMapViewGroup(t);if(null==s?void 0:s.jimuMapViews){this._mapLoadedTimer&&clearTimeout(this._mapLoadedTimer);const i=[];for(const l in s.jimuMapViews)if(s.jimuMapViews[l].dataSourceId)if(s.jimuMapViews[l].status===e.JimuMapViewStatus.Loaded){const e=[],t=s.jimuMapViews[l].dataSourceId;this.setDefaultConfigForDataSource(t);const n=a.MapViewManager.getInstance().getJimuMapViewById(s.jimuMapViews[l].id);yield this.waitForChildDataSourcesReady(n).finally((()=>we(this,void 0,void 0,(function*(){yield S(s.jimuMapViews[l].id).then((t=>{this.setState({isLayerAvailable:!0,jimuMapViewId:s.jimuMapViews[l].id}),(s.jimuMapViews[l].isActive||void 0===s.jimuMapViews[l].isActive)&&this.setState({activeDataSource:t.length>0?s.jimuMapViews[l].dataSourceId:""}),t.forEach((t=>{e.push({layerDsId:t.id})})),this.canAddDataSource(s.jimuMapViews[l].dataSourceId,i)&&i.push({label:this.getDataSourceLabel(s.jimuMapViews[l].dataSourceId),value:s.jimuMapViews[l].dataSourceId,isValid:t.length>0,availableLayers:e})}))}))))}else this._mapLoadedTimer=setTimeout((()=>{this.checkLayersAvailability(t)}),50);else this.setState({isLayerAvailable:!1});this.setState({dataSources:i},(()=>{this.updateConfigAsPerNewWebMap()}))}else this._mapLoadedTimer=setTimeout((()=>{this.checkLayersAvailability(t)}),50)})),this.canAddDataSource=(e,t)=>{let s=!0;return t.some((t=>{t.value===e&&(s=!1)})),s},this.getDataSourceLabel=e=>e?u(e).getLabel()||e:"",this.updateConfigAsPerNewWebMap=()=>we(this,void 0,void 0,(function*(){var t;let s=[];if((null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t.length)>0){const t=this.mvManager.getJimuMapViewGroup(this.props.useMapWidgetIds[0]),i=this.props.config.configInfo.asMutable({deep:!0});if(null==t?void 0:t.jimuMapViews){for(const e in t.jimuMapViews)t.jimuMapViews[e].dataSourceId?s.push(t.jimuMapViews[e].dataSourceId):s=[];for(const e in i)s.includes(e)||delete i[e];for(const s in t.jimuMapViews){const a=t.jimuMapViews[s].dataSourceId;i[a]&&t.jimuMapViews[s].status===e.JimuMapViewStatus.Loaded&&(yield S(t.jimuMapViews[s].id).then((e=>{var t,s;const l=[];e.forEach((e=>{l.push(e.id)})),null===(s=null===(t=this.props.config.configInfo[a].analysisSettings)||void 0===t?void 0:t.layersInfo)||void 0===s||s.forEach((e=>{if(!l.includes(e.useDataSource.dataSourceId)){const t=i[a].analysisSettings.layersInfo,s=t.findIndex((t=>t.useDataSource.dataSourceId===e.useDataSource.dataSourceId));s>-1&&t.splice(s,1)}}))})))}setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("configInfo",(0,e.Immutable)(i))})}),100),setTimeout((()=>{this.saveUseDataSourcesProps(this.props.useDataSources,i)}),200)}}})),this.showDsPanel=e=>{this.setState({activeDataSource:e,isAnalysisSettingsOpen:!1},(()=>{this.setState({isAnalysisSettingsOpen:!0})})),this.setDefaultConfigForDataSource(e)},this.isDataSourceValid=t=>{var s;return 0!==this.state.dataSources.length&&(null===(s=e.DataSourceManager.getInstance().getDataSource(t))||void 0===s?void 0:s.getChildDataSources().length)>0},this.onCloseDataItemPanel=()=>{this.setState({showDataItemPanel:!1}),this.index=0},this.onToggleGeneralSettings=()=>{this.setState({isGeneralSettingsOpen:!this.state.isGeneralSettingsOpen})},this.updateGeneralSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings",e],t)})},this.updateSearchSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"searchSettings",e],t)})},this.updateAnalysisSettings=(e,t)=>{const s=this.props.config.setIn(["configInfo",this.state.activeDataSource,"analysisSettings",e],t),i=this.getInitOutDataSource(s.configInfo);this.props.onSettingChange({id:this.props.id,config:s},i)},this.saveUseDataSourcesProps=(e,t)=>{const s=t||this.props.config.configInfo,i=[];let a=[];const l=(null==e?void 0:e.length)>0?null==e?void 0:e.filter(((t,s)=>e.findIndex((e=>e.dataSourceId===t.dataSourceId))===s)):[];l.length>0&&l.forEach(((e,t)=>{if(s.hasOwnProperty(e.rootDataSourceId)){const t=s[e.rootDataSourceId].analysisSettings.layersInfo;t.length>0&&t.forEach((t=>{t.useDataSource.dataSourceId===e.dataSourceId&&(i.length>0?null==i||i.forEach((t=>{t.dataSourceId!==e.dataSourceId&&i.push(e)})):i.push(e))}))}})),a=i.length>0?null==i?void 0:i.filter(((e,t)=>i.findIndex((t=>t.dataSourceId===e.dataSourceId))===t)):[];const n=this.getInitOutDataSource(s);setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:a},n)}),200)},this.getInitOutDataSource=t=>{var s,i;if(!this.props.useMapWidgetIds||0===this.props.useMapWidgetIds.length)return[];try{const a=[];for(const l in t)null===(i=null===(s=null==t?void 0:t[l])||void 0===s?void 0:s.analysisSettings.layersInfo)||void 0===i||i.forEach(((t,s)=>{var i;const l=t.label+" ("+this.nls(t.analysisInfo.analysisType)+")",n=e.DataSourceManager.getInstance(),o=null==n?void 0:n.getDataSource(t.useDataSource.dataSourceId),r=null!==(i=t.analysisInfo.analysisId)&&void 0!==i?i:s.toString();let h;h=t.analysisInfo.analysisType===d.Summary?this.getInitSchema(l,t.analysisInfo.summaryFields):o.getSchema();const p={id:b(this.props.widgetId,t.analysisInfo.analysisType,r),type:e.DataSourceTypes.FeatureLayer,label:l,isOutputFromWidget:!0,schema:{idField:h.idField,fields:h.fields},geometryType:o.getGeometryType()};a.push(p)}));return a}catch(e){return console.warn("Failed to create output data source in near me widget. ",e),[]}},this.getInitSchema=(t="",s)=>{const i={},a=[{alias:"OBJECTID",type:e.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"},{alias:this.nls("count"),type:e.JimuFieldType.Number,jimuName:"esriCTCOUNT",name:"esriCTCOUNT"}];return s.forEach((t=>{const s=t.fieldLabel.replace(/ /g,"");a.push({alias:t.fieldLabel,type:e.JimuFieldType.String,jimuName:s,name:s})})),null==a||a.forEach(((e,t)=>{0===t?i.OBJECTID=e:"esriCTCOUNT"===(null==e?void 0:e.name)?i.esriCTCOUNT=e:i[(null==e?void 0:e.jimuName)+t]=e})),{label:t,idField:"OBJECTID",fields:i}},this.index=0,this.state={dataSources:[],showDataItemPanel:!1,dataSourceName:"",isNoMapSelected:!0,mapWidgetExists:!0,isAnalysisSettingsOpen:!1,isGeneralSettingsOpen:!0,isOutputSettingsOpen:!0,isLayerAvailable:!1,activeDataSource:null,popperFocusNode:null,jimuMapViewId:""}}render(){var s,a;const l=null===(s=this.props.config.configInfo)||void 0===s?void 0:s[this.state.activeDataSource];return(0,e.jsx)("div",{css:(n=this.props.theme,e.css`
    .widget-setting-near-me {
      height: 100%;

      .map-selector-section .component-map-selector .form-control {
        width: 100%;
      }

      .nearme-analysis-tooltip {
        margin-bottom: 0rem!important;
        width: 177px;
      }

      .placeholder-container {
        height: calc(100% - 180px);

        .placeholder {
          flex-direction: column;

          .icon {
            color: var(--dark-200);
          }

          .hint {
            font-size: ${e.polished.rem(14)};
            font-weight: 500;
            color: var(--dark-500);
            max-width: ${e.polished.rem(160)};
          }
        }
      }

      .color-label {
        color: ${n.colors.palette.dark[400]};
      }

      .jimu-tree {
        width: 100%;
      }

      .data-item {
        display: flex;
        flex: 1;
        padding: 0.5rem 0.6rem;
        line-height: 23px;
        cursor: pointer;

        .data-item-name {
          word-break: break-word;
        }
      }
    }
  `),className:"h-100"},(0,e.jsx)("div",{className:"widget-setting-near-me"},(0,e.jsx)(t.SettingSection,{className:(0,e.classNames)("map-selector-section",{"border-0":this.state.isNoMapSelected})},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{className:"text-truncate setting-text-level-0",title:this.nls("selectMapWidgetLabel")},this.nls("selectMapWidgetLabel"))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(t.MapWidgetSelector,{onSelect:this.onMapWidgetSelected.bind(this),useMapWidgetIds:this.props.useMapWidgetIds})),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&!this.state.isLayerAvailable&&(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Alert,{tabIndex:0,onClose:function(){},open:!this.state.isLayerAvailable,text:this.nls("warningMsgIfNoLayersOnMap"),type:"warning"}))),this.state.isNoMapSelected&&(0,e.jsx)("div",{className:"d-flex placeholder-container justify-content-center align-items-center"},(0,e.jsx)("div",{className:"d-flex text-center placeholder justify-content-center align-items-center "},(0,e.jsx)(c,{size:48,className:"d-flex icon mb-2"}),(0,e.jsx)("p",{className:"hint"},this.nls("selectMapHint")))),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&this.state.isLayerAvailable&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("analysisSettingsLabel"),title:this.nls("analysisSettingsLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label setting-text-level-0"},this.nls("analysisSettingsLabel")))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("mapSettingsHintMsg"),className:"font-italic w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("mapSettingsHintMsg")))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{className:"w-100"},this.state.dataSources.length>0&&(0,e.jsx)(t.MultipleJimuMapConfig,{mapWidgetId:null===(a=this.props.useMapWidgetIds)||void 0===a?void 0:a[0],onClick:this.showDsPanel,isDataSourceValid:this.isDataSourceValid,invalidDataSourceTooltip:this.nls("warningMsgIfNoLayersOnMap"),sidePopperContent:this.state.isAnalysisSettingsOpen&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("analysisSettingsLabel"),title:this.nls("analysisSettingsLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-0"},this.nls("analysisSettingsLabel")))),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(W,{intl:this.props.intl,theme:this.props.theme2,config:null==l?void 0:l.searchSettings,onSearchSettingsUpdated:this.updateSearchSettings}))),(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(Fe,{widgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,selectedDs:this.state.activeDataSource,activeDsSearchConfig:null==l?void 0:l.searchSettings,activeDsLayersConfig:null==l?void 0:l.analysisSettings,allFeatureLayers:this.state.dataSources,useDataSourceConfig:this.props.useDataSources,onAnalysisSettingsUpdated:this.updateAnalysisSettings,getAddedLayersInfoUseDs:this.saveUseDataSourcesProps}))))})))),(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(i.CollapsablePanel,{label:this.nls("generalSettingsLabel"),"aria-label":this.nls("generalSettingsLabel"),isOpen:this.state.isGeneralSettingsOpen,onRequestOpen:()=>{this.onToggleGeneralSettings()},onRequestClose:()=>{this.onToggleGeneralSettings()}},(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(D,{intl:this.props.intl,theme:this.props.theme2,config:this.props.config.generalSettings,onGeneralSettingsUpdated:this.updateGeneralSettings})))))));var n}}function Oe(e){m.p=e}})(),y})())}}}));