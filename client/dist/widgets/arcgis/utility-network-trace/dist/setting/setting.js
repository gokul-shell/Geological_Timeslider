System.register(["jimu-core","jimu-for-builder","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/basic/color-picker","jimu-theme"],(function(e,t){var s={},a={},i={},o={},l={},r={},n={};return{setters:[function(e){s.DataSourceManager=e.DataSourceManager,s.DataSourceTypes=e.DataSourceTypes,s.JimuFieldType=e.JimuFieldType,s.JimuMapViewStatus=e.JimuMapViewStatus,s.React=e.React,s.classNames=e.classNames,s.css=e.css,s.defaultMessages=e.defaultMessages,s.getAppStore=e.getAppStore,s.jsx=e.jsx,s.polished=e.polished},function(e){a.BaseWidgetSetting=e.BaseWidgetSetting},function(e){i.Alert=e.Alert,i.Checkbox=e.Checkbox,i.Label=e.Label,i.NumericInput=e.NumericInput,i.Option=e.Option,i.Radio=e.Radio,i.Select=e.Select,i.Switch=e.Switch,i.Tooltip=e.Tooltip,i.defaultMessages=e.defaultMessages,i.utils=e.utils},function(e){o.MapWidgetSelector=e.MapWidgetSelector,o.MultipleJimuMapConfig=e.MultipleJimuMapConfig,o.SettingRow=e.SettingRow,o.SettingSection=e.SettingSection},function(e){l.MapViewManager=e.MapViewManager,l.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.ThemeColorPicker=e.ThemeColorPicker},function(e){n.getTheme2=e.getTheme2}],execute:function(){e((()=>{var e={88866:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2ZM6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5Z"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14Z" clip-rule="evenodd"></path></svg>'},26826:e=>{"use strict";e.exports=l},48891:e=>{"use strict";e.exports=s},23137:e=>{"use strict";e.exports=a},34796:e=>{"use strict";e.exports=n},30726:e=>{"use strict";e.exports=i},77756:e=>{"use strict";e.exports=o},41362:e=>{"use strict";e.exports=r}},t={};function u(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,u),i.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var s in t)u.o(t,s)&&!u.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{__set_webpack_public_path__:()=>j,default:()=>y});var e=u(48891),t=u(23137),s=u(30726),a=u(77756);const i={sourceLabel:"Source",selectMapWidgetHint:"The Map widget must have maps that contain a utility network (version 5 or later) and shared trace configurations (ArcGIS Enterprise 10.9 or later)",dataConfigLabel:"Trace Results",mapSettingsHintMsg:"Customize the trace result options for each map",resultAreaLabel:"Result area",resultAreaTooltip:"Generate a result area polygon with an information popup around the trace result elements.",createResultAreaLabel:"Create result area",colorLabel:"Color",showWhenTraceCompleteLabel:"Show when trace completes",shapeLabel:"Shape",convexHullLabel:"Convex Hull",convexHullTooltip:"The smallest convex polygon enclosing all input features. If a distance is defined, it will be applied as a buffer to the convex hull.",bufferLabel:"Buffer",bufferTooltip:"Polygon generated from an offset at each feature's vertices. The distance value will be used to buffer the features.",distanceLabel:"Distance",meters:"Meters",feet:"Feet",kilometers:"Kilometers",miles:"Miles",mAreaUnit:"m",ftAreaUnit:"ft",kiAreaUnit:"ki",miAreaUnit:"mi",warningMsgToSelectMap:"A Map widget must be selected to configure this widget.",warningNoMap:"This Map widget does not have any maps.",warningNoTraces:"This map cannot be used with this widget. A utility network or trace configurations are missing.",traceId:"Trace Id",traceName:"Trace name",traceDescription:"Trace description",startingPoints:"Starting points",barriers:"Barriers",username:"User",version:"Version",traceDate:"Date",elementCount:"Count of features",functionResult:"Trace functions",areaStatistic:"Area statistic"};var o=u(26826);function l(t){return e.css`
    .layer-item-panel {
      .setting-header {
        padding: ${e.polished.rem(10)} ${e.polished.rem(16)} ${e.polished.rem(0)}
          ${e.polished.rem(16)};
      }
      .setting-title {
        font-size: ${e.polished.rem(16)};
        .layer-item-label {
          color: ${t.colors.palette.dark[600]};
        }
      }
      .setting-container {
        height: calc(100% - ${e.polished.rem(50)});
        overflow: auto;

        .title-desc {
          color: ${t.colors.palette.dark[200]};
        }
      }
    }
  `}var r=u(88866),n=u.n(r);const p=t=>{const s=window.SVG,{className:a}=t,i=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s}(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",a);return s?e.React.createElement(s,Object.assign({className:o,src:n()},i)):e.React.createElement("svg",Object.assign({className:o},i))},h={traceResultAreaSettings:{enableResultArea:!1,resultAreaProperties:{type:"convexhull",distance:10,unit:"",areaUnit:"",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1}}},d=[{value:"meters"},{value:"feet"},{value:"kilometers"},{value:"miles"}],g=[{value:"traceId",label:i.traceId},{value:"traceName",label:i.traceName},{value:"traceDescription",label:i.traceDescription},{value:"startingPoints",label:i.startingPoints},{value:"barriers",label:i.barriers},{value:"version",label:i.version},{value:"username",label:i.username},{value:"date",label:i.traceDate},{value:"elementCount",label:i.elementCount},{value:"functionResult",label:i.functionResult},{value:"areaStatistic",label:i.areaStatistic}];var m,f=u(41362),v=u(34796);!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(m||(m={}));const S=e=>{switch(e){case"feet":return m.Feet;case"miles":return m.Miles;case"kilometers":return m.Kilometers;case"meters":return m.Meters;default:return 1e3}},b=()=>{const t=(0,e.getAppStore)().getState().portalSelf;return"english"===(null==t?void 0:t.units)?"feet":"meters"},w=t=>{return s=void 0,a=void 0,o=function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const s=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==s?void 0:s.isDataSourceSet)&&!s.areChildDataSourcesCreated()?s.childDataSourcesReady().then((()=>s)).catch((e=>s)):Promise.resolve(s)},new((i=void 0)||(i=Promise))((function(e,t){function l(e){try{n(o.next(e))}catch(e){t(e)}}function r(e){try{n(o.throw(e))}catch(e){t(e)}}function n(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(l,r)}n((o=o.apply(s,a||[])).next())}));var s,a,i,o};class x extends e.React.PureComponent{constructor(t){super(t),this.nls=t=>{const a=Object.assign({},i,s.defaultMessages,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:a[t]}):a[t]},this.componentDidMount=()=>{this.state.apiLoaded||this.loadAPIModule()},this.loadAPIModule=()=>{return e=this,t=void 0,a=function*(){if(this.state.apiLoaded)return Promise.resolve();yield(0,o.loadArcGISJSAPIModules)(["esri/Color"]).then((e=>{[this.EsriColor]=e,this.setState({apiLoaded:!0})}))},new((s=void 0)||(s=Promise))((function(i,o){function l(e){try{n(a.next(e))}catch(e){o(e)}}function r(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,r)}n((a=a.apply(e,t||[])).next())}));var e,t,s,a},this.onEnableResultAreaChange=e=>{this.setState({enableResultArea:e.target.checked},(()=>{this.props.onResultAreaSettingsUpdated("enableResultArea",this.state.enableResultArea)}))},this.updateResultAreaProperty=()=>{const e=new this.EsriColor(s.utils.getColorValue(this.state.resultAreaColor));e.a=.5;const t={type:this.state.resultAreaShapeType,distance:this.state.shapeDistanceInput,unit:this.state.shapeUnit,areaUnit:"square-"+this.state.shapeUnit,color:{color:e.toRgba(),haloOpacity:h.traceResultAreaSettings.resultAreaProperties.color.haloOpacity,hex:s.utils.getColorValue(this.state.resultAreaColor)},show:this.state.showWhenTraceComplete};this.props.onResultAreaSettingsUpdated("resultAreaProperties",t)},this.onResultAreaColorChange=e=>{this.setState({resultAreaColor:e},(()=>{this.updateResultAreaProperty()}))},this.onShowWhenTraceCompleteSwitchChange=e=>{this.setState({showWhenTraceComplete:e.target.checked},(()=>{this.updateResultAreaProperty()}))},this.handleShapeChange=e=>{this.setState({resultAreaShapeType:e},(()=>{this.updateResultAreaProperty()}))},this.onShapeDistanceChange=e=>{this.setState({shapeDistanceInput:e})},this.onShapeDistanceAcceptValue=e=>{this.setState({shapeDistanceInput:null!=e?e:10},(()=>{this.updateResultAreaProperty()}))},this.onShapeUnitsChange=e=>{const t=((e,t)=>{const s=S(t);return e>s?s:e})(this.state.shapeDistanceInput,e.target.value);this.setState({shapeUnit:e.target.value,shapeDistanceInput:t},(()=>{this.updateResultAreaProperty()}))},this.state={apiLoaded:!1,enableResultArea:this.props.config.enableResultArea,resultAreaColor:this.props.config.resultAreaProperties.color.hex?this.props.config.resultAreaProperties.color.hex:"#ffa500",showWhenTraceComplete:this.props.config.resultAreaProperties.show,resultAreaShapeType:this.props.config.resultAreaProperties.type,shapeUnit:this.props.config.resultAreaProperties.unit?this.props.config.resultAreaProperties.unit:b(),shapeDistanceInput:this.props.config.resultAreaProperties.distance}}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%",marginTop:"5px"},css:(this.props.theme,e.css`
    .cursor-pointer {
      cursor: pointer;
    }

    .shapeTypeWidth {
      width: calc(100% - 16px);
    }
  `)},(0,e.jsx)(a.SettingSection,null,(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(s.Label,{"aria-label":this.nls("resultAreaLabel"),title:this.nls("resultAreaLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"w-100 text-truncate flex-grow-1 setting-text-level-1"},this.nls("resultAreaLabel"))),(0,e.jsx)(s.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("resultAreaTooltip"),title:this.nls("resultAreaTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(p,null)))),(0,e.jsx)(a.SettingRow,{label:this.nls("createResultAreaLabel")},(0,e.jsx)(s.Switch,{role:"switch","aria-label":this.nls("createResultAreaLabel"),title:this.nls("createResultAreaLabel"),checked:this.state.enableResultArea,onChange:this.onEnableResultAreaChange})),this.state.enableResultArea&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(a.SettingRow,{label:this.nls("colorLabel")},(0,e.jsx)(f.ThemeColorPicker,{"aria-label":this.nls("colorLabel"),specificTheme:(0,v.getTheme2)(),value:this.state.resultAreaColor?this.state.resultAreaColor:"#ffa500",onChange:e=>{this.onResultAreaColorChange(e)}})),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(s.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(s.Checkbox,{role:"checkbox","aria-label":this.nls("showWhenTraceCompleteLabel"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showWhenTraceComplete,onChange:this.onShowWhenTraceCompleteSwitchChange.bind(this)}),this.nls("showWhenTraceCompleteLabel"))),(0,e.jsx)(a.SettingRow,{flow:"wrap"},(0,e.jsx)(s.Label,{tabIndex:0,"aria-label":this.nls("shapeLabel"),title:this.nls("shapeLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-2"},this.nls("shapeLabel")))),(0,e.jsx)(a.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(s.Label,{className:"m-0 shapeTypeWidth",centric:!0},(0,e.jsx)(s.Radio,{role:"radio","aria-label":this.nls("convexHullLabel"),className:"cursor-pointer",value:this.nls("convexHullLabel"),onChange:()=>{this.handleShapeChange("convexhull")},checked:"convexhull"===this.props.config.resultAreaProperties.type}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{"convexhull"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("convexhull")},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||"convexhull"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("convexhull")}},this.nls("convexHullLabel"))),(0,e.jsx)(s.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("convexHullTooltip"),title:this.nls("convexHullTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(p,null)))),(0,e.jsx)(a.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(s.Label,{className:"m-0 shapeTypeWidth",centric:!0},(0,e.jsx)(s.Radio,{role:"radio","aria-label":this.nls("bufferLabel"),className:"cursor-pointer",value:this.nls("bufferLabel"),onChange:()=>{this.handleShapeChange("buffer")},checked:"buffer"===this.props.config.resultAreaProperties.type}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{"buffer"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("buffer")},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||"buffer"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("buffer")}},this.nls("bufferLabel"))),(0,e.jsx)(s.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("bufferTooltip"),title:this.nls("bufferTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(p,null)))),(0,e.jsx)(a.SettingRow,{flow:"wrap"},(0,e.jsx)(s.Label,{tabIndex:0,"aria-label":this.nls("distanceLabel"),title:this.nls("distanceLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-2"},this.nls("distanceLabel")))),(0,e.jsx)("div",{className:"pt-1"},(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(s.NumericInput,{style:{width:103},"aria-label":this.state.shapeDistanceInput+"",title:this.state.shapeDistanceInput+"",size:"sm",defaultValue:this.state.shapeDistanceInput,min:0,max:S(this.state.shapeUnit),value:this.state.shapeDistanceInput,showHandlers:!1,onChange:this.onShapeDistanceChange,onAcceptValue:this.onShapeDistanceAcceptValue}),(0,e.jsx)(s.Select,{menuRole:"menu","aria-label":this.state.shapeUnit.toString(),style:{width:129},className:"pl-2",size:"sm",name:"shapeUnits",value:this.state.shapeUnit.toString(),onChange:this.onShapeUnitsChange},d.map(((t,a)=>(0,e.jsx)(s.Option,{role:"option","aria-label":t.value,key:a,value:t.value},this.nls(t.value))))))))))}}var M=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function l(e){try{n(a.next(e))}catch(e){o(e)}}function r(e){try{n(a.throw(e))}catch(e){o(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,r)}n((a=a.apply(e,t||[])).next())}))};class y extends t.BaseWidgetSetting{constructor(t){super(t),this.dsRef=e.React.createRef(),this.mvManager=o.MapViewManager.getInstance(),this.dataSourceOptions=[],this._mapLoadedTimer=null,this.nls=t=>{const a=Object.assign({},i,s.defaultMessages,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:a[t]}):a[t]},this.resetConfig=()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("configInfo",{}),useDataSources:[]},[])},this.componentDidUpdate=e=>{if(e.label!==this.props.label){const e=[this.getInitOutDataSource()];setTimeout((()=>{this.props.onSettingChange({id:this.props.id},e)}),100)}},this.onMapWidgetSelected=e=>M(this,void 0,void 0,(function*(){let t;if(this.resetConfig(),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e})}),100),e.length>0){t=!1,yield this.getAvailableDataSources(e);const s=[this.getInitOutDataSource()];this.props.onSettingChange({id:this.props.id},s)}else t=!0;this.updateConfigForMapWidget(t)})),this.getInitSchema=(t="",s)=>{const a={},i=[];return i.push({alias:"OBJECTID",type:e.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"}),g.forEach((t=>{var a,o,l,r;const n=(null===(r=null===(l=null===(o=null===(a=null==s?void 0:s.configInfo)||void 0===a?void 0:a[this.state.activeDataSource])||void 0===o?void 0:o.traceResultAreaSettings)||void 0===l?void 0:l.resultAreaProperties)||void 0===r?void 0:r.areaUnit)||"square-feet";"areaStatistic"===t.value?"square-miles"===n?i.push({alias:this.nls(t.value)+"("+this.nls("unitsLabelSquareMiles")+")",type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):"square-meters"===n?i.push({alias:this.nls(t.value)+"("+this.nls("unitsLabelSquareMeters")+")",type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):"square-feet"===n?i.push({alias:this.nls(t.value)+"("+this.nls("unitsLabelSquareFeet")+")",type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):"square-kilometers"===n&&i.push({alias:this.nls(t.value)+"("+this.nls("unitsLabelSquareKilometers")+")",type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):"version"===t.value||"elementCount"===t.value?i.push({alias:this.nls(t.value),type:e.JimuFieldType.Number,jimuName:t.value,name:t.value}):i.push({alias:this.nls(t.value),type:e.JimuFieldType.String,jimuName:t.value,name:t.value})})),null==i||i.forEach(((e,t)=>{a[null==e?void 0:e.jimuName]=e,0===t&&(a.OBJECTID=e)})),{label:t,idField:"OBJECTID",fields:a}},this.getInitOutDataSource=t=>{const a=Object.assign({},s.defaultMessages),i=this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:a.outputStatistics},{name:this.props.label+" "+this.nls("resultAreaLabel")}),o=`${this.props.widgetId}-output`,l=this.getInitSchema(i,t||this.props.config);return{id:o,type:e.DataSourceTypes.FeatureLayer,label:i,geometryType:"esriGeometryPolygon",originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:l}},this.updateConfigForMapWidget=e=>{this.setState({mapWidgetExists:!e,isNoMapSelected:e},(()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("useMapWidget",!e)})}))},this.getAvailableDataSources=t=>M(this,void 0,void 0,(function*(){const s=this.mvManager.getJimuMapViewGroup(t);if(this.dataSourceOptions=[],s&&s.jimuMapViews){this._mapLoadedTimer&&clearTimeout(this._mapLoadedTimer);for(const a in s.jimuMapViews)if(s.jimuMapViews[a].dataSourceId)if(s.jimuMapViews[a].status===e.JimuMapViewStatus.Loaded){(s.jimuMapViews[a].isActive||void 0===s.jimuMapViews[a].isActive)&&this.setState({activeDataSource:s.jimuMapViews[a].dataSourceId});const t=o.MapViewManager.getInstance().getJimuMapViewById(s.jimuMapViews[a].id);yield w(t).finally((()=>M(this,void 0,void 0,(function*(){var t;const i=yield this.checkIfMapViewHasTraces(s.jimuMapViews[a]);if(this.dataSourceOptions.push({label:this.getDataSourceLabel(s.jimuMapViews[a].dataSourceId),value:s.jimuMapViews[a].dataSourceId,isValid:i,dataSource:s.jimuMapViews[a]}),i){const i=e.DataSourceManager.getInstance(),o=null===(t=null==i?void 0:i.getDataSource(s.jimuMapViews[a].dataSourceId))||void 0===t?void 0:t.getChildDataSources(),l=[];null==o||o.forEach((e=>{var t;let i;if("GROUP_LAYER"===e.type){const t=e.getChildDataSources();t&&t.forEach((e=>{var t;"Table"!==(null===(t=e.layerDefinition)||void 0===t?void 0:t.type)&&(i={dataSourceId:null==e?void 0:e.id,mainDataSourceId:null==e?void 0:e.id,rootDataSourceId:s.jimuMapViews[a].dataSourceId},l.push(i))}))}else"Table"!==(null===(t=e.layerDefinition)||void 0===t?void 0:t.type)&&(i={dataSourceId:null==e?void 0:e.id,mainDataSourceId:null==e?void 0:e.id,rootDataSourceId:s.jimuMapViews[a].dataSourceId},l.push(i))})),this.props.onSettingChange({id:this.props.id,useDataSources:l}),(yield this.getTracesInMapView(s.jimuMapViews[a])).length>0&&this.setConfigForSelectedDs(s.jimuMapViews[a].dataSourceId)}}))))}else this._mapLoadedTimer=setTimeout((()=>{this.getAvailableDataSources(t)}),50)}else this._mapLoadedTimer=setTimeout((()=>{this.getAvailableDataSources(t)}),50)})),this.checkIfMapViewHasTraces=e=>{let t=!1,s=!0;const a=e.view;return a.when().then((()=>{const e=a.map;if(e.hasOwnProperty("utilityNetworks")&&null!==e.utilityNetworks){const a=e.utilityNetworks.getItemAt(0);a.load().catch((()=>{s=!1})),s&&a.hasOwnProperty("sharedNamedTraceConfigurations")&&a.sharedNamedTraceConfigurations.length>0&&(t=!0)}return t}))},this.getTracesInMapView=e=>M(this,void 0,void 0,(function*(){const t=e.view;let s=[];return t.when().then((()=>M(this,void 0,void 0,(function*(){const e=t.map;if(e.hasOwnProperty("utilityNetworks")&&null!==e.utilityNetworks){const t=e.utilityNetworks.getItemAt(0);return yield t.load(),t.hasOwnProperty("sharedNamedTraceConfigurations")&&(s=t.sharedNamedTraceConfigurations),s}return s}))))})),this.getDataSourceLabel=t=>t?e.DataSourceManager.getInstance().getDataSource(t).getLabel()||t:"",this.setConfigForSelectedDs=e=>{if(!this.props.config.configInfo.hasOwnProperty(e)){const t=h;t.traceResultAreaSettings.resultAreaProperties.unit=b(),t.traceResultAreaSettings.resultAreaProperties.areaUnit="square-"+b(),this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",e],t)})}},this.isDataSourceValid=e=>{var t,s,a,i;return 0!==this.dataSourceOptions.length&&((null===(t=this.dataSourceOptions[0])||void 0===t?void 0:t.value)===e?null===(s=this.dataSourceOptions[0])||void 0===s?void 0:s.isValid:this.dataSourceOptions.length>0&&(null===(a=this.dataSourceOptions[1])||void 0===a?void 0:a.value)===e?null===(i=this.dataSourceOptions[1])||void 0===i?void 0:i.isValid:void 0)},this.showDsPanel=e=>{this.setState({activeDataSource:e,showTraceItemPanel:!1},(()=>{this.setState({showTraceItemPanel:!0})}))},this.updateResultAreaSettings=(e,t)=>{const s=this.props.config.setIn(["configInfo",this.state.activeDataSource,"traceResultAreaSettings",e],t),a=[this.getInitOutDataSource(s)];this.props.onSettingChange({id:this.props.id,config:s},a)},this.state={activeDataSource:null,isNoMapSelected:!this.props.config.useMapWidget,mapWidgetExists:!0,showTraceItemPanel:!1}}componentDidMount(){var t,s;let a;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const i=null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0];if(null===(s=(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===s?void 0:s[i]){a=!1,this.getAvailableDataSources(this.props.useMapWidgetIds);const e=[this.getInitOutDataSource()];setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config},e)}),100)}else this.resetConfig(),a=!0}else a=!0;this.updateConfigForMapWidget(a)}render(){var t,i;return(0,e.jsx)("div",{css:(i=this.props.theme,e.css`
    .widget-setting-utility-trace {
      .map-selector-section .component-map-selector .form-control {
        width: 100%;
      }

      .warningMsg {
        padding: 0.25rem !important;
        margin-top: -7px;
      }

      .warningMsg .left-part {
        margin-right: 0 !important;
      }

      .color-label {
        color: ${i.colors.palette.dark[400]};
      }
    }
  `)},(0,e.jsx)("div",{className:"widget-setting-utility-trace"},(0,e.jsx)(a.SettingSection,{className:(0,e.classNames)("map-selector-section",{"border-0":this.state.isNoMapSelected}),title:this.nls("sourceLabel")},(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(s.Label,{tabIndex:0,"aria-label":this.nls("selectMapWidget"),title:this.nls("selectMapWidget"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("selectMapWidget"))),(0,e.jsx)(s.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("selectMapWidgetHint"),title:this.nls("selectMapWidgetHint"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline ep-tooltip"},(0,e.jsx)(p,{size:"m"})))),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(a.MapWidgetSelector,{onSelect:this.onMapWidgetSelected.bind(this),useMapWidgetIds:this.props.useMapWidgetIds}))),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&(0,e.jsx)(a.SettingSection,null,(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(s.Label,{tabIndex:0,"aria-label":this.nls("dataConfigLabel"),title:this.nls("dataConfigLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label setting-text-level-0"},this.nls("dataConfigLabel")))),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(s.Label,{tabIndex:0,"aria-label":this.nls("mapSettingsHintMsg"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("mapSettingsHintMsg")))),(0,e.jsx)(a.SettingRow,null,this.dataSourceOptions.length>0&&(0,e.jsx)("div",{className:"w-100"},(0,e.jsx)(a.MultipleJimuMapConfig,{mapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onClick:this.showDsPanel,disableSwitchMap:!0,isDataSourceValid:this.isDataSourceValid,sidePopperContent:this.state.showTraceItemPanel&&(0,e.jsx)(e.React.Fragment,null,this.state.activeDataSource&&this.props.config.configInfo[this.state.activeDataSource]&&(0,e.jsx)("div",{className:"w-100 h-100",css:l(this.props.theme)},(0,e.jsx)("div",{className:"setting-container"},(0,e.jsx)(a.SettingRow,{flow:"wrap"},(0,e.jsx)(x,{intl:this.props.intl,theme:this.props.theme,config:this.props.config.configInfo[this.state.activeDataSource].traceResultAreaSettings,onResultAreaSettingsUpdated:this.updateResultAreaSettings})))))}))),this.props.config.useMapWidget&&this.dataSourceOptions.length<=0&&(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(s.Alert,{tabIndex:0,className:"warningMsg",onClose:function(){},open:!0,text:this.nls("warningNoMap"),type:"warning"})))))}}function j(e){u.p=e}})(),c})())}}}));