System.register(["jimu-core","jimu-ui","jimu-layouts/layout-runtime","jimu-for-builder"],(function(e,t){var i={},o={},s={},n={};return{setters:[function(e){i.AnimationContext=e.AnimationContext,i.AppMode=e.AppMode,i.ExpressionResolverComponent=e.ExpressionResolverComponent,i.Immutable=e.Immutable,i.LayoutItemType=e.LayoutItemType,i.LinkType=e.LinkType,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ReactResizeDetector=e.ReactResizeDetector,i.TransitionContainer=e.TransitionContainer,i.TransitionDirection=e.TransitionDirection,i.TransitionType=e.TransitionType,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.defaultMessages=e.defaultMessages,i.getAppStore=e.getAppStore,i.getNextAnimationId=e.getNextAnimationId,i.hooks=e.hooks,i.jimuHistory=e.jimuHistory,i.jsx=e.jsx,i.lodash=e.lodash,i.polished=e.polished,i.urlUtils=e.urlUtils,i.utils=e.utils},function(e){o.LinkTip=e.LinkTip,o.WidgetPlaceholder=e.WidgetPlaceholder,o._Link=e._Link,o.hooks=e.hooks,o.styleUtils=e.styleUtils},function(e){s.LayoutEntry=e.LayoutEntry,s.LayoutItemSizeModes=e.LayoutItemSizeModes,s.searchUtils=e.searchUtils},function(e){n.ContentServiceWrapper=e.ContentServiceWrapper,n.LayoutServiceProvider=e.LayoutServiceProvider,n.widgetService=e.widgetService}],execute:function(){e((()=>{var e={90858:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#FFF" fill-rule="nonzero" d="M2 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4Zm5-3a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2H7Zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4Zm0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2H7Zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4Zm0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2H7Zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4ZM2 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4Zm0 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4Z"></path></svg>'},41235:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m2.116 1.5.969 1.678H1.05v3H0l1.5 2 1.5-2h-.951v-2h1.614l4.618 8H2.049v-2H1.05v3h7.809l1.257 2.178.866-.5L2.982 1l-.866.5Zm9.982 8.678h.95v2h-2.611l.576 1h3.036v-3h1.05l-1.501-2-1.5 2Zm.951-4v-2H5.817l-.578-1h8.81v3h-1Z" clip-rule="evenodd"></path></svg>'},60397:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.049 6V3h13v3h-1V4h-11v2H3L1.5 7.999 0 6h1.049Zm12 4h-.952l1.5-2 1.5 2h-1.049v3H1.05v-3h1v2h11v-2Z" clip-rule="evenodd"></path></svg>'},48891:e=>{"use strict";e.exports=i},23137:e=>{"use strict";e.exports=n},74758:e=>{"use strict";e.exports=s},30726:e=>{"use strict";e.exports=o}},t={};function l(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,l),s.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var a={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(a),l.d(a,{Widget:()=>R,__set_webpack_public_path__:()=>A,default:()=>P});var e,t,i,o,s=l(48891),n=l(30726);s.TransitionType.None,s.TransitionDirection.Horizontal,function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3",e.Style4="STYLE4",e.Style5="STYLE5",e.Style6="STYLE6",e.Style7="STYLE7",e.Style8="STYLE8",e.Style9="STYLE9",e.Style10="STYLE10"}(e||(e={})),function(e){e.Default="DEFAULT",e.Hover="HOVER"}(t||(t={})),function(e){e.None="NONE",e.Default="DEFAULT",e.Hover="HOVER"}(i||(i={})),function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(o||(o={}));var r=l(74758);class d extends s.React.PureComponent{constructor(){super(...arguments),this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.getStyle=e=>{const{widgetId:t}=this.props,i=this.checkIsBackgroundTransparent(e);return s.css`
      &,
      .animation-list {
        overflow: hidden;
      }
      .card-link {
        cursor: pointer;
      }
      ${"&.card-"+t} {
        padding: 0;
        border: 0;
        background-color: transparent;
        height: 100%;
        position: relative;
        .card-content {
          width: 100%;
          height: 100%;
          /* overflow: hidden; */
          & > div {
            width: 100%;
            height: 100%;
          }
        }
      }
      .edit-mask {
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 10;
      }
      .clear-background {
        background: transparent !important;
      }
      .card-link {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }
      .clear-background:focus {
        outline: none;
      }
      .surface-1 {
        border: none !important;
        background: ${i&&"none !important"};
      }
      .jimu-link {
        text-align: left;
      }
      ${"&.card-"+t}:hover {
      }
    `}}checkIsBackgroundTransparent(e){var t,i,o;const{cardConfigs:s}=this.props;return"rgba(0,0,0,0)"===(null===(o=null===(i=null===(t=null==s?void 0:s[e])||void 0===t?void 0:t.backgroundStyle)||void 0===i?void 0:i.background)||void 0===o?void 0:o.color)}}var u=l(60397),c=l.n(u);const p=e=>{const t=window.SVG,{className:i}=e,o=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:n,src:c()},o)):s.React.createElement("svg",Object.assign({className:n},o))};var h=l(41235),v=l.n(h);const g=e=>{const t=window.SVG,{className:i}=e,o=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(e,["className"]),n=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:n,src:v()},o)):s.React.createElement("svg",Object.assign({className:n},o))};var y=l(23137);const f=[0,5],m=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["right-start","bottom-start","top-start","top-end"]}}],I=[{name:"offset",options:{offset:[0,10]}},{name:"arrow",enabled:!0}],S=s.ReactRedux.connect(((e,t)=>{var i;const{appMode:o}=t;return window.jimuConfig.isInBuilder&&o!==s.AppMode.Run?{selection:t.selectionIsInCard&&(null===(i=null==e?void 0:e.appRuntimeInfo)||void 0===i?void 0:i.selection)}:{selection:void 0}}))(class extends d{constructor(e){super(e),this.lastResizeCall=null,this.handleCopyTo=(e,t,i,o)=>{if(!i)return;const{layouts:s,builderSupportModules:n,browserSizeMode:l,builderStatus:a}=this.props;let d=n.jimuForBuilderLib.getAppConfigAction(),u=d.appConfig;const c=r.searchUtils.findLayoutId(s[a],l,u.mainSizeMode),p=r.searchUtils.findLayoutId(s[t],l,u.mainSizeMode);if(o){const e=n.widgetModules.searchUtils,t=i.widgetId,o=u.widgets[t].parent[l],s=o.find((e=>e.layoutId===c)),a=o.find((e=>e.layoutId===p)),r=e.findLayoutItem(u,s);d.editLayoutItemProperty(a,"bbox",r.bbox).editLayoutItemProperty(a,"setting",r.setting)}else{const e=y.LayoutServiceProvider.getService(u,p).createBlankItem(u,p);u=e[0];const t=e[1],o={layoutId:p,layoutItemId:t},s=r.searchUtils.findLayoutItem(u,{layoutId:c,layoutItemId:i.id});u=y.widgetService.addParent(u,i.widgetId,o,l),d=n.jimuForBuilderLib.getAppConfigAction(u),d.editLayoutItemProperty(o,"bbox",s.bbox).editLayoutItemProperty(o,"setting",s.setting).editLayoutItemProperty(o,"type",s.type).editLayoutItemProperty(o,"widgetId",s.widgetId).adjustOrderOfItem(o,-1)}this.setState({widgetsUpdate:Symbol()}),d.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.editStatus=(e,t)=>{const{dispatch:i,widgetId:o}=this.props;i(s.appActions.widgetStatePropChange(o,e,t))},this.toggleStatus=e=>{var i;const{cardConfigs:o}=this.props,n=null===(i=null==o?void 0:o.HOVER)||void 0===i?void 0:i.enable,l=e===t.Hover;let{previousIndex:a,currentIndex:r,hoverPlayId:d,regularPlayId:u}=this.state;n&&(a=l?0:1,r=l?1:0,d=l?(0,s.getNextAnimationId)():null,u=l?null:(0,s.getNextAnimationId)()),this.setState({previousIndex:a,currentIndex:r,hoverPlayId:d,regularPlayId:u})},this.handleBreakLink=e=>{const{builderSupportModules:t,browserSizeMode:i,selection:o,builderStatus:n,dispatch:l,widgetId:a}=this.props;let d=t.jimuForBuilderLib.getAppConfigAction();const u=d.appConfig,c=r.searchUtils.findLayoutItem(u,o);if(!c)return;const p=u.widgets[a].layouts[n][i],h=d.duplicateLayoutItemInSameLayout({layoutId:p,layoutItemId:c.id});d.editLayoutItemProperty({layoutId:o.layoutId,layoutItemId:h},"bbox",c.bbox).removeLayoutItem({layoutId:p,layoutItemId:c.id},!1);const v=r.searchUtils.findLayoutItem(d.appConfig,{layoutId:p,layoutItemId:h}),g=new y.ContentServiceWrapper(d.appConfig,v);g.removeSizeModeParent(i),g.addParent({layoutId:p,layoutItemId:h},i),d=t.jimuForBuilderLib.getAppConfigAction(g.getConfig()),o.layoutId===p&&o.layoutItemId===c.id&&l(s.appActions.selectionChanged(null));const f=d.appConfig.layouts[p].content,m=Object.keys(f)[Object.keys(f).length-1];if(m){const e=f[m];l(s.appActions.selectionChanged({layoutId:p,layoutItemId:e.id}))}d.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.initParentOfNewWidgetAfterIsolate=(e,t)=>{const{browserSizeMode:i}=this.props,o=e.parent[i],s=null==o?void 0:o.filter((e=>e.layoutId===t));return e.setIn(["parent",i],s)},this.getCopyDropdownItems=e=>{const{cardConfigs:i,layouts:o,browserSizeMode:n,selection:l,builderStatus:a,builderSupportModules:d}=this.props,u=d.jimuForBuilderLib.getAppConfigAction().appConfig,c=r.searchUtils.findLayoutItem(u,l);if(!l||!c||!window.jimuConfig.isInBuilder)return{items:(0,s.Immutable)([]),title:""};const p=[];let h="",v=!0,g=!0;const y=(e,t)=>d.widgetModules.searchUtils.getContentsInLayoutWithRecrusiveLayouts(u,e,s.LayoutItemType.Widget,n).indexOf(t)>-1;return a===t.Default?((()=>{if(i[t.Hover]){const e=r.searchUtils.findLayoutId(o[t.Hover],n,u.mainSizeMode);y(e,u.layouts[l.layoutId].content[l.layoutItemId].widgetId)||(g=!1),p.push({label:this.formatMessage("applyTo",{status:this.formatMessage("hover").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,t.Hover,c,g)}})}})(),h=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()})):a===t.Hover&&((()=>{const e=r.searchUtils.findLayoutId(o[t.Default],n,u.mainSizeMode);y(e,u.layouts[l.layoutId].content[l.layoutItemId].widgetId)||(v=!1),p.push({label:this.formatMessage("applyTo",{status:this.formatMessage("default").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,t.Default,c,v)}})})(),h=this.formatMessage("linkedTo",{where:this.formatMessage("default").toLocaleLowerCase()})),e?p.push({label:this.formatMessage("isolate"),event:this.handleBreakLink}):h=this.formatMessage("isolate"),{items:(0,s.Immutable)(p),title:h}},this.getCardToolsStyle=e=>s.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,this.renderCardTools=()=>{if(!window.jimuConfig.isInBuilder)return;const{builderSupportModules:e,selectionIsCard:i,selectionIsInCard:o,appMode:n,hideCardTool:l,cardConfigs:a}=this.props,{BuilderPopper:r,GLOBAL_RESIZING_CLASS_NAME:d,GLOBAL_H5_DRAGGING_CLASS_NAME:u,GLOBAL_DRAGGING_CLASS_NAME:c}=e.widgetModules;let p=!0;return(!o&&!i||n===s.AppMode.Run||l)&&(p=!1),this.props.isEditing&&a[t.Hover].enable&&(0,s.jsx)(r,{placement:"left-start",trapFocus:!1,autoFocus:!1,css:s.css`
            .${c} &,
            .${d} &,
            .${u} & {
              &.popper {
                display: none;
              }
            }
          `,reference:this.layoutRef.current,offset:f,modifiers:m,open:p},this.getCardMenuElement())},this.getCardMenuElement=()=>{if(!window.jimuConfig.isInBuilder)return;const{selection:e,widgetId:i,builderSupportModules:o,browserSizeMode:n,builderStatus:l,selectionIsCard:a}=this.props,r=o.jimuForBuilderLib.getAppConfigAction().appConfig,{searchUtils:d,BuilderDropDown:u,BuilderButton:c,withBuilderTheme:h}=o.widgetModules,v=a,y=!v&&e&&d&&d.getRelatedLayoutItemsInWidgetByLayoutInfo(r,e,i,n).length>1,{items:f,title:m}=this.getCopyDropdownItems(y),S=f&&f.length>0,b=h((e=>(0,s.jsx)("div",{className:"status-group d-flex flex-column align-items-center p-2",css:this.getCardToolsStyle(e)},(0,s.jsx)(c,{active:l===t.Default,onClick:e=>{this.handleBuilderStatusChange(e,t.Default)}},this.formatMessage("default")),(0,s.jsx)(c,{active:l===t.Hover,className:"mt-1",onClick:e=>{this.handleBuilderStatusChange(e,t.Hover)}},this.formatMessage("hover")),!v&&(S||y)&&(0,s.jsx)(u,{className:"mt-1 w-100",toggleIsIcon:!0,toggleTitle:m,toggleType:"default",direction:"left",toggleContent:e=>y?(0,s.jsx)(p,{size:16}):(0,s.jsx)(g,{size:16}),modifiers:I,items:f}))));return(0,s.jsx)(b,null)},this.getEditorStyle=()=>s.css`
      &.card-content {
        .fixed-layout {
          border: 0 !important;
        }
      }
    `,this.renderCardEditor=()=>{const{cardConfigs:e,LayoutEntry:i,layouts:o,browserSizeMode:l}=this.props,{hoverPlayId:a,regularPlayId:r}=this.state,d=o[t.Default],u=o[t.Hover],c=e[t.Default].backgroundStyle.setIn(["boxShadow","color"],"transparent"),p=e[t.Hover].backgroundStyle.setIn(["boxShadow","color"],"transparent"),h=e.transitionInfo,v=[],g=Object.assign({},n.styleUtils.toCSSStyle(c||{})),y=(0,s.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.regularLayoutRef,key:t.Default},(0,s.jsx)("div",{className:"w-100, h-100 animation-list",style:g},(0,s.jsx)(s.AnimationContext.Provider,{value:{setting:(null==h?void 0:h.oneByOneEffect)||null,playId:r,oid:d[l]}},(0,s.jsx)(i,{className:"h-100",isRepeat:!0,layouts:d,isInWidget:!0}))));if(v.push(y),!e[t.Hover].enable)return v;const f=Object.assign({},n.styleUtils.toCSSStyle(p||{})),m=(0,s.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.hoverLayoutRef,key:t.Hover},(0,s.jsx)("div",{className:"w-100, h-100 animation-list",style:f},(0,s.jsx)(s.AnimationContext.Provider,{value:{setting:(null==h?void 0:h.oneByOneEffect)||null,playId:a,oid:null==u?void 0:u[l]}},(0,s.jsx)(i,{className:"h-100",isRepeat:!0,layouts:u,isInWidget:!0}))));return v.push(m),v},this.getCardStyle=()=>{var e,i,o,s;const{builderStatus:l,cardConfigs:a}=this.props,r=a[t.Hover].enable?l:t.Default,d={boxShadow:null===(i=null===(e=a[r])||void 0===e?void 0:e.backgroundStyle)||void 0===i?void 0:i.boxShadow,borderRadius:null===(s=null===(o=a[r])||void 0===o?void 0:o.backgroundStyle)||void 0===s?void 0:s.borderRadius};return Object.assign({},n.styleUtils.toCSSStyle(d))},this.state={didMount:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null,widgetsUpdate:null},this.regularLayoutRef=s.React.createRef(),this.hoverLayoutRef=s.React.createRef(),this.layoutRef=s.React.createRef(),this.isUpdateFirst=!0}componentDidMount(){this.setState({didMount:!0})}componentDidUpdate(e){var i,o;const{cardConfigs:s,builderStatus:n}=this.props,l=e.cardConfigs,a=(null===(i=null==l?void 0:l.transitionInfo)||void 0===i?void 0:i.previewId)===(null===(o=null==s?void 0:s.transitionInfo)||void 0===o?void 0:o.previewId),r=e.builderStatus&&e.builderStatus!==n&&!this.isUpdateFirst,d=l[t.Hover].enable!==s[t.Hover].enable;(!a||r||d)&&this.toggleStatus(n),this.isUpdateFirst&&(this.isUpdateFirst=!1)}handleBuilderStatusChange(e,t){var i;this.editStatus("showCardSetting",t),this.editStatus("builderStatus",t),null===(i=null==this?void 0:this.props)||void 0===i||i.selectSelf(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}render(){var e,t;const{cardConfigs:i,widgetId:o,isShowMask:n,builderStatus:l,selectionIsCard:a,selectionIsInCard:r}=this.props,{didMount:d,previousIndex:u,currentIndex:c}=this.state,p=i.transitionInfo,h=`card-${o}`,v=(a||r?null==p?void 0:p.previewId:null)||null;return(0,s.jsx)("div",{css:this.getStyle(l),style:this.getCardStyle(),className:h},d&&this.renderCardTools(),(0,s.jsx)("div",{className:"w-100, h-100",ref:this.layoutRef},(0,s.jsx)(s.TransitionContainer,{previousIndex:u,currentIndex:c,transitionType:null===(e=null==p?void 0:p.transition)||void 0===e?void 0:e.type,direction:null===(t=null==p?void 0:p.transition)||void 0===t?void 0:t.direction,playId:d?v:null,withOneByOne:!!(null==p?void 0:p.oneByOneEffect)},this.renderCardEditor())),n&&(0,s.jsx)("div",{className:"edit-mask position-absolute"}))}}),{useRef:b,useState:w}=s.React,C=e=>{var t;const{useDataSources:i,appMode:o,linkParam:l,widgetId:a,queryObject:r,children:d,changeIsCanClickLink:u}=e,c=b(null),p=b(null),h=s.React.useContext(s.jimuHistory.HistoryContext),[v,g]=w(!1),[y,f]=w(null),m=n.hooks.useApplyLinkResult(),I=()=>{clearTimeout(p.current),g(!0),setTimeout((()=>{g(!1)}),3e3)},S=()=>{var e,t;let i=!1;return(null==l?void 0:l.linkType)===s.LinkType.WebAddress&&(l.value?i=s.urlUtils.isAbsoluteUrl(l.value):(null===(e=null==l?void 0:l.expression)||void 0===e?void 0:e.name)&&(i=s.urlUtils.isAbsoluteUrl(null===(t=null==l?void 0:l.expression)||void 0===t?void 0:t.name))),i},C=(e,t)=>{if(!e)return!1;const i=null==e?void 0:e.getAttribute("z-index"),o=null==e?void 0:e.role,s=e&&e.tagName||"",n="button"===s.toLowerCase()||"button"===o,l="a"===s.toLowerCase()||"linkClick"===t.exbEventType,a="input"===s.toLowerCase()||"input"===o;return n||l||!!i&&i>-1||a},x=s.css`
    .list-clear-background {
      background: transparent !important;
    }
    .list-link {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
    }
  `,j=s.hooks.useEventCallback((()=>{const e=null==l?void 0:l.openType,t={linkType:null==l?void 0:l.linkType,value:null==l?void 0:l.value};let i=r;return(null==l?void 0:l.linkType)===s.LinkType.WebAddress&&(t.value=y||(null==t?void 0:t.value),i=void 0),{queryObject:i,target:e,linkTo:t}})),L=e=>{e.stopPropagation()};return(0,s.jsx)("div",{className:"w-100 h-100",onClick:e=>{if(u&&!u())return;const t=window.jimuConfig.isInBuilder;if(o===s.AppMode.Design&&t)return!1;const i=(e=>{const t=e.target;return C(t,e)||C(null==t?void 0:t.parentNode,e)})(e),n=S();if(!i&&(null==l?void 0:l.linkType)&&(null==l?void 0:l.linkType)!==s.LinkType.None){const i=j();if(n){if(t)return I(),!1;"_self"===l.openType?window.location.href=i.linkTo.value:i.linkTo.value&&window.open(i.linkTo.value,l.openType)}else if((null==l?void 0:l.linkType)===s.LinkType.Block)c.current.click();else{if(t&&(null==l?void 0:l.linkType)===s.LinkType.PrintPreview)return I(),!1;m({evt:e,linkTo:i.linkTo,target:i.target,replace:!1,queryObject:i.queryObject})}}"linkClick"===e.exbEventType&&delete e.exbEventType},css:x},(()=>{const e=j();return(0,s.jsx)(n._Link,{className:"p-0 w-100 h-100 border-0 list-clear-background list-link",ref:c,to:e.linkTo,target:e.target,queryObject:e.queryObject,onClick:L})})(),d,i&&(0,s.jsx)(s.ExpressionResolverComponent,{useDataSources:i,expression:null==l?void 0:l.expression,onChange:e=>{e.isSuccessful?f(e.value):f("")},widgetId:a}),window.jimuConfig.isInBuilder&&(S()||(null==l?void 0:l.linkType)===s.LinkType.PrintPreview)&&(0,s.jsx)(n.LinkTip,{reference:null===(t=c.current)||void 0===t?void 0:t.id,open:v,href:(()=>{const e=j();return s.urlUtils.getHrefFromLinkTo(e.linkTo,r,h&&h.location)||""})()}))},{useState:x,useRef:j,useEffect:L}=s.React,k=function(e){var i,o;const l=j(!1),{cardConfigs:a,layouts:d,appMode:u,linkParam:c,browserSizeMode:p,hoverPlayId:h,regularPlayId:v,previewId:g,previousIndex:y,currentIndex:f,queryObject:m}=e,[I,S]=x(null),[b,w]=x(!1),[k,M]=x(!1);L((()=>{var e,t;S(null==a?void 0:a.transitionInfo),w(null===(e=null==a?void 0:a.HOVER)||void 0===e?void 0:e.enable),M((null===(t=window.jimuConfig)||void 0===t?void 0:t.isInBuilder)||!1)}),[a]),L((()=>{l.current=!0}),[]);const T=s.hooks.useEventCallback((()=>{var e,i;const o=[];let l,g,y,f;k&&u!==s.AppMode.Run?(g=R(t.Default),l=d[t.Default],b&&(f=R(t.Hover),y=d[t.Hover])):(l=d[t.Default],g=R(t.Default),b&&(y=d[t.Hover],f=R(t.Hover)));const m=Object.assign({},n.styleUtils.toCSSStyle(g||{})),I=(null==c?void 0:c.linkType)&&(null==c?void 0:c.linkType)!==s.LinkType.None,S=(0,s.jsx)("div",{className:(0,s.classNames)("card-content d-flex surface-1",I?"card-link":""),tabIndex:I?-1:1,key:t.Default},(0,s.jsx)("div",{className:"w-100 animation-list",style:m},(0,s.jsx)("div",{className:"d-flex w-100 h-100"},(0,s.jsx)(s.AnimationContext.Provider,{value:{setting:(null===(e=null==a?void 0:a.transitionInfo)||void 0===e?void 0:e.oneByOneEffect)||null,playId:v,oid:null==l?void 0:l[p]}},(0,s.jsx)(r.LayoutEntry,{layouts:l})))));if(o.push(S),b){const e=Object.assign({},n.styleUtils.toCSSStyle(f||{})),l=(0,s.jsx)("div",{className:(0,s.classNames)("card-content d-flex surface-1 w-100 h-100",I?"card-link":""),key:t.Hover},(0,s.jsx)("div",{className:"w-100 h-100 animation-list",style:e},(0,s.jsx)("div",{className:"d-flex w-100 h-100"},(0,s.jsx)(s.AnimationContext.Provider,{value:{setting:(null===(i=null==a?void 0:a.transitionInfo)||void 0===i?void 0:i.oneByOneEffect)||null,playId:h,oid:(null==y?void 0:y[p])||null}},(0,s.jsx)(r.LayoutEntry,{layouts:y})))));o.push(l)}return o})),R=e=>{const t=a[e].backgroundStyle;return(null==t?void 0:t.boxShadow)?t.setIn(["boxShadow","color"],"transparent"):t};return(0,s.jsx)(C,{linkParam:c,appMode:u,queryObject:m},(0,s.jsx)(s.TransitionContainer,{previousIndex:y,currentIndex:f,transitionType:null===(i=null==I?void 0:I.transition)||void 0===i?void 0:i.type,direction:null===(o=null==I?void 0:I.transition)||void 0===o?void 0:o.direction,playId:l.current?g:null,withOneByOne:!!(null==I?void 0:I.oneByOneEffect)},T()))};class M extends d{constructor(e){super(e),this.onMouse=(e,t=!1)=>{var i;const{cardConfigs:o}=this.props,n=null===(i=null==o?void 0:o.HOVER)||void 0===i?void 0:i.enable;let{previousIndex:l,currentIndex:a,hoverPlayId:r,regularPlayId:d}=this.state;n&&(l=t?0:1,a=t?1:0,r=t?(0,s.getNextAnimationId)():null,d=t?null:(0,s.getNextAnimationId)()),this.setState({isHover:t,previousIndex:l,currentIndex:a,hoverPlayId:r,regularPlayId:d})},this.getCardShadowStyle=()=>{var e,i;const{cardConfigs:o}=this.props,{isHover:s}=this.state,l=s&&o[t.Hover].enable?t.Hover:t.Default,a={boxShadow:null===(e=o[l].backgroundStyle)||void 0===e?void 0:e.boxShadow,borderRadius:null===(i=o[l].backgroundStyle)||void 0===i?void 0:i.borderRadius};return Object.assign({},n.styleUtils.toCSSStyle(a))},this.state={url:"",isHover:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null},this.regularLayoutRef=s.React.createRef(),this.hoverLayoutRef=s.React.createRef(),this.linkRef=s.React.createRef(),this.didMount=!1}componentDidMount(){this.didMount=!0}componentDidUpdate(e){var t,i;const o=this.props.cardConfigs,{cardConfigs:n}=e;(null===(t=null==o?void 0:o.transitionInfo)||void 0===t?void 0:t.previewId)===(null===(i=null==n?void 0:n.transitionInfo)||void 0===i?void 0:i.previewId)||this.setState({hoverPlayId:(0,s.getNextAnimationId)(),regularPlayId:(0,s.getNextAnimationId)()})}render(){const{widgetId:e,cardConfigs:i,linkParam:o,queryObject:n,layouts:l,appMode:a,browserSizeMode:r}=this.props,{previousIndex:d,currentIndex:u,regularPlayId:c,hoverPlayId:p}=this.state,h=i.transitionInfo,v=`card-${e}`,g=(null==h?void 0:h.previewId)||null,y=0===u?t.Default:t.Hover;return(0,s.jsx)("div",{css:this.getStyle(y),style:this.getCardShadowStyle(),className:v,onMouseLeave:e=>{this.onMouse(e,!1)},onMouseEnter:e=>{this.onMouse(e,!0)}},(0,s.jsx)(k,{linkParam:o,queryObject:n,cardConfigs:i,layouts:l,appMode:a,browserSizeMode:r,hoverPlayId:p,regularPlayId:c,previousIndex:d,currentIndex:u,previewId:g}))}}const T={_layout_REGULAR_label:"Regular",_layout_HOVER_label:"Hover",applyTo:"Apply to {status}",isolate:"Isolate",linkedToAnd:"Linked to {where1} and {where2}",linkedTo:"Linked to {where}",placeHolderTip:"Please select a card template.",showSelected:"Show selection",_widgetLabel:"Card"};class R extends s.React.PureComponent{constructor(e){super(e),this.setListParentSizeInWidgetState=()=>{const{browserSizeMode:e,id:t,parentSize:i,layoutId:o}=this.props,n=(0,s.getAppStore)().getState().appConfig,l=s.utils.findViewportSize(n,e),a=`div.layout[data-layoutid=${o}]`,r=document.querySelector(a),d={width:(null==r?void 0:r.clientWidth)||l.width,height:(null==r?void 0:r.clientHeight)||l.height};i&&i.height===d.height&&i.width===d.width||this.props.dispatch(s.appActions.widgetStatePropChange(t,"parentSize",d))},this.setSelectionStatus=()=>{const{id:e,selectionIsInSelf:t}=this.props;this.props.dispatch(s.appActions.widgetStatePropChange(e,"selectionIsInSelf",t))},this.setSettinglayout=()=>{const{layoutId:e,layoutItemId:t,id:i,selectionIsSelf:o}=this.props,{isSetlayout:n}=this.state;e&&i&&t&&!n&&o&&(this.props.dispatch(s.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:e,layoutItemId:t})),this.setState({isSetlayout:!0}))},this.onResize=(e,t)=>{this.updateCardToolPosition()},this.updateCardToolPosition=()=>{const{selectionIsSelf:e}=this.props;e&&(this.setState({hideCardTool:!0}),this.updateCardToolTimeout&&(clearTimeout(this.updateCardToolTimeout),this.updateCardToolTimeout=void 0),this.updateCardToolTimeout=setTimeout((()=>{this.setState({hideCardTool:!1})}),500))},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:Object.assign(Object.assign({},T),s.defaultMessages)[e]},t),this.editStatus=(e,t)=>{const{dispatch:i,id:o}=this.props;i(s.appActions.widgetStatePropChange(o,e,t))},this.editWidgetConfig=e=>{window.jimuConfig.isInBuilder&&this.props.builderSupportModules.jimuForBuilderLib.getAppConfigAction().editWidgetConfig(this.props.id,e).exec()},this.isEditing=()=>{const{appMode:e,config:t,selectionIsSelf:i,selectionIsInSelf:o}=this.props;return!!window.jimuConfig.isInBuilder&&(i||o)&&window.jimuConfig.isInBuilder&&e!==s.AppMode.Run&&t.isItemStyleConfirm},this.checkIsShowMask=()=>{const{appMode:e,config:t}=this.props;return!(!window.jimuConfig.isInBuilder||window.jimuConfig.isInBuilder&&e!==s.AppMode.Run&&t.isItemStyleConfirm)},this.editBuilderAndSettingStatus=e=>{this.editStatus("showCardSetting",e),this.editStatus("builderStatus",e)},this.getAppConfig=()=>(0,s.getAppStore)().getState().appConfig,this.getStyle=e=>{const{id:t}=this.props;return s.css`
      ${"&.card-widget-"+t} {
        overflow: visible;
        background-color: transparent;
        border: ${s.polished.rem(0)} solid
          ${s.polished.rgba(e.colors.black,window.jimuConfig.isInBuilder&&this.isEditing()?.2:0)};
        width: 100%;
        height: 100%;
      }
    `},this.getCardProps=()=>{const{config:e,selectionIsInSelf:t,selectionIsSelf:i,builderStatus:o,appMode:n,queryObject:l}=this.props,a=window.jimuConfig.isInBuilder&&n===s.AppMode.Design?{hideCardTool:this.state.hideCardTool,selectionIsCard:i,selectionIsInCard:t,isEditing:this.isEditing(),isShowMask:this.checkIsShowMask(),builderStatus:o,selectSelf:this.selectSelf}:{linkParam:e.linkParam,queryObject:l};return Object.assign(Object.assign({},this.getOtherProps()),a)},this.getOtherProps=()=>{const{config:e,theme:t,id:i,appMode:o,builderSupportModules:s,layouts:n,browserSizeMode:l,dispatch:a,isRTL:r,isHeightAuto:d,isWidthAuto:u}=this.props;return{browserSizeMode:l,isRTL:r,builderSupportModules:s,formatMessage:this.formatMessage,dispatch:a,widgetId:i,interact:window.jimuConfig.isInBuilder&&s.widgetModules.interact,appMode:o,theme:t,LayoutEntry:this.state.LayoutEntry,layouts:n,cardConfigs:e,isHeightAuto:d,isWidthAuto:u}},this.cardRender=()=>{const e=this.getCardProps(),{appMode:t}=this.props,i=window.jimuConfig.isInBuilder&&t===s.AppMode.Design?S:M;return(0,s.jsx)(i,Object.assign({},e))};const t={LayoutEntry:null,hideCardTool:!1,isSetlayout:!1};window.jimuConfig.isInBuilder?t.LayoutEntry=this.props.builderSupportModules.LayoutEntry:t.LayoutEntry=r.LayoutEntry,this.state=t,this.onResize=this.onResize.bind(this),this.selectSelf=this.selectSelf.bind(this),this.debounceOnResize=s.lodash.debounce(((e,t)=>{this.onResize(e,t)}),200)}componentDidUpdate(e,i){var o;const{appMode:n,selectionStatus:l,builderStatus:a,left:r,top:d}=this.props;n!==s.AppMode.Run&&l!==a&&l&&this.editBuilderAndSettingStatus(l),e.appMode!==n&&n===s.AppMode.Run&&this.editBuilderAndSettingStatus(t.Default),(null==e?void 0:e.selectionIsInSelf)!==(null===(o=this.props)||void 0===o?void 0:o.selectionIsInSelf)&&this.setSelectionStatus(),d===e.top&&r===e.left||this.updateCardToolPosition(),this.setSettinglayout(),this.setListParentSizeInWidgetState()}selectSelf(){if(!window.jimuConfig.isInBuilder)return!1;const{layoutId:e,layoutItemId:t}=this.props,i={layoutId:e,layoutItemId:t};this.props.dispatch(s.appActions.selectionChanged(i))}render(){const{config:e,id:t}=this.props,i=(0,s.classNames)("jimu-widget","widget-card","card-widget-"+t);return e.itemStyle?(0,s.jsx)("div",{className:i,css:this.getStyle(this.props.theme)},this.cardRender(),(0,s.jsx)(s.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize})):(0,s.jsx)(n.WidgetPlaceholder,{widgetId:this.props.id,icon:l(90858),message:this.formatMessage("placeHolderTip")})}}R.mapExtraStateProps=(e,i)=>{var o,s,n,l,a,d,u,c,p,h,v,g,y,f,m;const I=e&&e.appConfig,{layouts:S,layoutId:b,layoutItemId:w,builderSupportModules:C,id:x}=i,j=null==e?void 0:e.browserSizeMode,L=(null==e?void 0:e.widgetsState[i.id])&&(null===(o=null==e?void 0:e.widgetsState[i.id])||void 0===o?void 0:o.builderStatus)||t.Default,k=e&&e.appRuntimeInfo&&e.appRuntimeInfo.selection,M=k&&C&&C.widgetModules&&C.widgetModules.selectionInCard(k,x,I,!1);let T;M&&(T=Object.keys(S).find((e=>r.searchUtils.findLayoutId(S[e],j,I.mainSizeMode)===k.layoutId)));const R=null===(s=I.layouts)||void 0===s?void 0:s[b],P=null===(l=null===(n=null==R?void 0:R.content)||void 0===n?void 0:n[w])||void 0===l?void 0:l.setting,A=(null===(a=null==P?void 0:P.autoProps)||void 0===a?void 0:a.height)===r.LayoutItemSizeModes.Auto||!0===(null===(d=null==P?void 0:P.autoProps)||void 0===d?void 0:d.height),O=(null===(u=null==P?void 0:P.autoProps)||void 0===u?void 0:u.width)===r.LayoutItemSizeModes.Auto||!0===(null===(c=null==P?void 0:P.autoProps)||void 0===c?void 0:c.width);let E;if(window.jimuConfig.isInBuilder){const e=null===(g=null===(v=null===(h=null===(p=I.layouts)||void 0===p?void 0:p[b])||void 0===h?void 0:h.content)||void 0===v?void 0:v[w])||void 0===g?void 0:g.bbox;E=e&&{left:e.left,top:e.top}}return{selectionIsSelf:(null==k?void 0:k.layoutId)===b&&(null==k?void 0:k.layoutItemId)===w,selectionIsInSelf:M,selectionStatus:T,appMode:null===(y=null==e?void 0:e.appRuntimeInfo)||void 0===y?void 0:y.appMode,browserSizeMode:null==e?void 0:e.browserSizeMode,builderStatus:L,isRTL:null===(f=null==e?void 0:e.appContext)||void 0===f?void 0:f.isRTL,left:E&&E.left,top:E&&E.top,isHeightAuto:A,isWidthAuto:O,queryObject:e.queryObject,parentSize:(null===(m=e.widgetsState[i.id])||void 0===m?void 0:m.parentSize)||null}};const P=R;function A(e){l.p=e}})(),a})())}}}));